<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0014)about:internet -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Adobe RoboHelp 8" />
<title>WMI Agentless Plugins Project</title>
<link rel="StyleSheet" href="../../Bookshelf.css" type="text/css" />
<script type="text/javascript" language="JavaScript">
//<![CDATA[
function ehlp_showtip(current,e,text)
{
  if ((parseInt(navigator.appVersion) == 4) && (navigator.appName == 'Netscape'))
  {
    document.tooltip.document.write("<layer bgColor='yellow' style='border:1px solid black;font-size:12px;'>"+ text + "<\/layer>");
    document.tooltip.document.close();
    document.tooltip.left=e.pageX+5;
    document.tooltip.top=e.pageY+5;
    document.tooltip.visibility="show";
  }
}
function ehlp_hidetip()
{
  document.tooltip.visibility="hidden";
}
//]]>
</script>
<script type="text/javascript" language="JavaScript">
//<![CDATA[
function reDo() {
  if (innerWidth != origWidth || innerHeight != origHeight)
     location.reload();
}
if ((parseInt(navigator.appVersion) == 4) && (navigator.appName == "Netscape")) {
        origWidth = innerWidth;
        origHeight = innerHeight;
        onresize = reDo;
}
onerror = null; 
//]]>
</script>
<style type="text/css">
/*<![CDATA[*/
<!--
div.WebHelpPopupMenu { position:absolute;
left:0px;
top:0px;
z-index:4;
visibility:hidden; }
-->
/*]]>*/
</style>

<script type="text/javascript" language="javascript1.2" src="../../whmsg.js">
</script>
<script type="text/javascript" language="javascript" src="../../whver.js">
</script>
<script type="text/javascript" language="javascript1.2" src="../../whproxy.js">
</script>
<script type="text/javascript" language="javascript1.2" src="../../whutils.js">
</script>
<script type="text/javascript" language="javascript1.2" src="../../whlang.js">
</script>
<script type="text/javascript" language="javascript1.2" src="../../whtopic.js">
</script>
</head>
<body>
<script type="text/javascript" language="javascript1.2">
//<![CDATA[
<!--
if (window.gbWhTopic)
{
        var strUrl = document.location.href;
        var bc = 0;
        var n = strUrl.toLowerCase().indexOf("bc-");
        if(n != -1)
        {
                document.location.href = strUrl.substring(0, n);
                bc = strUrl.substring(n+3);
        }

        if (window.addTocInfo)
        {
        addTocInfo("OPEN SOURCE REFERENCE\nGroundWork OS Projects\nWMI Agentless Plugins Project");
addButton("show",BTN_TEXT,"Show Table of Contents","","","","",0,0,"","","");

        }
        if (window.writeBtnStyle)
                writeBtnStyle();

        if (window.writeIntopicBar)
                writeIntopicBar(1);

        
        

        if (window.setRelStartPage)
        {
        setRelStartPage("../../Bookshelf.htm");

                autoSync(0);
                sendSyncInfo();
                sendAveInfoOut();
        }
}
else
        if (window.gbIE4)
                document.location.reload();

//-->
//]]>
</script><script type="text/javascript" language="javascript">
//<![CDATA[
document.write("<p  style=\"text-align:right;color:#0000ff;font-family:Arial;font-size:7pt;font-weight: normal;font-style: normal;text-decoration: none;\">");
AddMasterBreadcrumbs("../../Bookshelf.htm", "color:#0000ff;font-family:Arial;font-size:7pt;font-weight: normal;font-style: normal;text-decoration: none;", "&gt;", "Home", "../../Welcome_to_GroundWork_Monitor/index.htm");
document.write("<a style=\"color:#0000ff;font-family:Arial;font-size:7pt;font-weight: normal;font-style: normal;text-decoration: none;\" href=\"osr_monarch.htm\">OPEN SOURCE REFERENCE<\/a> &gt; <a style=\"color:#0000ff;font-family:Arial;font-size:7pt;font-weight: normal;font-style: normal;text-decoration: none;\" href=\"osr_monarch.htm\">GroundWork OS Projects<\/a> &gt; WMI Agentless Plugins Project<\/p>");
//]]>
</script>
<p>&#160;</p>
<h1><img src="../../Shared_Images/square.gif" alt="square.gif" style="border: none;" width="15" height="15" border="0" /> Open Source Reference</h1>
<h3 align="right"><a href="../../Welcome_to_GroundWork_Monitor/index.htm" title="Topic Home" onmouseover="if ((parseInt(navigator.appVersion) == 4) &amp;&amp; (navigator.appName == 'Netscape')) ehlp_showtip(this,event,'Topic Home');" onmouseout="if ((parseInt(navigator.appVersion) == 4) &amp;&amp; (navigator.appName == 'Netscape')) ehlp_hidetip();"><img src="../../Shared_Images/homeicon.gif" alt="homeicon.gif" style="border: none;" width="33" height="27" border="0" /></a> <img src="../../Shared_Images/printicon.gif" onclick="window.print()" alt="Print Page" title="Print Page" style="border: none;" width="33" height="27" border="0" /> <a href="mailto:support@groundworkopensource.com?subject=WMI" title="Send Comments"><img src="../../Shared_Images/commentsicon.gif" alt="Send Comments" title="Send Comments" style="border: none;" width="33" height="27" border="0" /></a></h3>
<h2>GroundWork Open Source Projects</h2>
<h3>Windows Management Instrumentation (WMI)</h3>
<p>Windows Management Instrumentation (WMI) is a management standard technology for accessing management information and automating administrative tasks in an enterprise environment. There are two main systems management architectures; Agent-based where the proprietary software agent is loaded on a managed system and, Agent-less which depends on management functionality that is built into a managed system. See <a href="http://msdn.microsoft.com/library?url=/library/en-us/WMIsdk/WMI/WMI_start_page.asp" target="_blank">Microsoft Developer Network (MSDN)</a> for a detailed overview of WMI.</p>
<h4>GroundWork WMI Agent-less Plugins Project</h4>
<p>This project consists of a collection of script monitors (.vbs for starters) that use the Microsoft .Net Framework and WMI to retrieve performance data from remote Windows hosts without the need for agents on the remote hosts. Initially we have about 20 scripts, although it is a fairly minor matter to script others.</p>
<p>To support the extra WMI checks of system uptime you can find the plugin called <span class="Code">get_system_uptime.vbs</span> which has been added to this project in the GroundWork knowledge base here <a href="https://kb.groundworkopensource.com/display/SUPPORT/How%2bto%2buse%2bWMI%2bagentless%2bplugins" target="_blank">WMI Agentless Plugins</a>.</p>
<h4>Typical Monitor</h4>
<p>A typical monitor works like this:</p>
<p class="CodeGroup">cscript //nologo check_cpu.vbs -h hostname -w -c -user username -pass password</p>
<p>This script returns a string to stand out that says something like <span class="Code">OK - CPU Utilization 67%" or "WARNING - CPU Utilization 89%" or "CRITICAL - CPU Utilization 98%</span>. The warning and critical thresholds will be passed as command line arguments (in percent).</p>
<p>In addition it returns an exit value like this:</p>
<p class="CodeGroup">0 = OK 1 = Warning 2 = Critical 3 = Error</p>
<p>All scripts return syntax and help if passed the --help command line option. And all scripts return performance data formatted according to the <a href="http://nagiosplug.sourceforge.net/developer-guidelines.html" target="_blank">Nagios Plugin Developer's Guidelines</a>.</p>
<h3>Zip Archive with nrpe_nt and .vbs Monitors</h3>
<p>These monitors implement the agentless WMI monitors for Windows.</p>
<ol>
<li class="p-Numbering">
<p class="Numbering">Install this directory on your Windows proxy server under root (i.e. <span class="CodeInline">C:\nrpe_nt</span>).</p>
</li>
<li class="p-Numbering">
<p class="Numbering">Change directories (<span class="CodeInline">cd</span>) into this directory.</p>
</li>
<li class="p-Numbering">
<p class="Numbering">Enter <span class="CodeInline">nrpe_nt -i</span> to install the <span class="CodeInline">nrpe_nt</span> agent as a service on the proxy server.</p>
</li>
<li class="p-Numbering">
<p class="Numbering">You will need to edit the <span class="CodeInline">nrpe.cfg</span> file in that directory and change the IP of the allowed hosts to match your Nagios server IP. This allows Nagios to access the nrpe_nt service.</p>
</li>
<li class="p-Numbering">
<p class="Numbering">On the nagios end you will need some command definitions for your <span class="CodeInline">check_commands.cfg</span> file.</p>
</li>
<li class="p-Numbering">
<p class="Numbering">Once you have <span class="CodeInline">nrpe_nt</span> up and running and the check command definitions in you can start setting up your service templates and services.</p>
</li>
<li class="p-Numbering">
<p class="Numbering">Each of the plugins can be executed from the command line using the <span class="CodeInline">--help</span> option which gives you usage. Get them all working from the proxy server command prompt first, then move to the Nagios Server and get them working from the command line there - using the syntax outlined below.</p>
</li>
</ol>
<h4>Notes</h4>
<p>Please note that these command definitions and the actual commands as defined in <span class="CodeInline">nrpe.cfg</span> in the config file might not line up exactly. They came from different places.</p>
<p>Also note that in the <span class="CodeInline">nrpe.cfg</span> file we have two versions of each monitor. One uses authentication while the other assumes that the proxy server has the same Administrator password as the monitored servers. In that case no authentication strings are passed. The checkcommand definitions above all use authentication (therefore the <span class="CodeInline">_auth</span> on the end of the script names called on the proxy server).</p>
<p>The last command line <span class="CodeInline">$ARGx$</span> argument passed in the below definitions is the <span class="CodeInline">username</span> (typically supplied in the service template). The final argument <span class="CodeInline">$USER9$</span> is the password which is in the <span class="CodeInline">nagios resources.cfg</span> file where <span class="CodeInline">$USER9$</span> is defined as the password. Around here we keep that file (and the passwords, community strings etc. in a secured subdirectory).</p>
<h4>Example</h4>
<p>There should be no carriage returns in the actual <span class="CodeInline">command_line</span> (the IP address is the address of the Proxy Server):</p>
<p class="CodeGroup"># nagios-WMI-cpu check command definition</p>
<p class="CodeGroup">define command {</p>
<p class="CodeGroup">command_name check_WMI_cpu</p>
<p class="CodeGroup">command_line $USER1$/check_nrpe -H 192.168.1.243 -c check_cpu_auth -a</p>
<p class="CodeGroup">$HOSTADDRESS$ $ARG1$ $ARG2$ $ARG3$ $USER9$</p>
<p class="CodeGroup">}</p>
<p class="CodeGroup"># nagios-WMI-disk check command definition</p>
<p class="CodeGroup">define command {</p>
<p class="CodeGroup">command_name check_WMI_disk</p>
<p class="CodeGroup">command_line $USER1$/check_nrpe -H 192.168.1.243 -c check_disk_auth -a</p>
<p class="CodeGroup">$HOSTADDRESS$ $ARG1$ $ARG2$ $ARG3$ $ARG4$ $USER9$</p>
<p class="CodeGroup">}</p>
<p class="CodeGroup">&#160;</p>
<p class="CodeGroup"># nagios-WMI-disks check command definition</p>
<p class="CodeGroup">define command {</p>
<p class="CodeGroup">command_name check_WMI_disks</p>
<p class="CodeGroup">command_line $USER1$/check_nrpe -H 192.168.1.243 -c check_disk_auth -a</p>
<p class="CodeGroup">$HOSTADDRESS$ $ARG1$ $ARG2$ $ARG3$ $USER9$</p>
<p class="CodeGroup">}</p>
<p class="CodeGroup">&#160;</p>
<p class="CodeGroup"># nagios-WMI-mem check command definition</p>
<p class="CodeGroup">define command {</p>
<p class="CodeGroup">command_name check_WMI_mem command_line $USER1$/check_nrpe -H 192.168.1.243 -c check_mem_auth -a</p>
<p class="CodeGroup">$HOSTADDRESS$ $ARG1$ $ARG2$ $ARG3$ $USER9$</p>
<p class="CodeGroup">}</p>
<p class="CodeGroup">&#160;</p>
<p class="CodeGroup"># commands check_WMI_printque</p>
<p class="CodeGroup">define command {</p>
<p class="CodeGroup">command_name check_WMI_printque</p>
<p class="CodeGroup">command_line $USER1$/check_nrpe -H 192.168.1.243 -c check_printque_auth -a</p>
<p class="CodeGroup">$HOSTADDRESS$ $ARG1$ $ARG2$ $ARG3$ $USER9$</p>
<p class="CodeGroup">}</p>
<p class="CodeGroup">&#160;</p>
<p class="CodeGroup"># nagios-WMI-proc check command definition</p>
<p class="CodeGroup">define command {</p>
<p class="CodeGroup">command_name check_WMI_procs</p>
<p class="CodeGroup">command_line $USER1$/check_nrpe -H 192.168.1.243 -c check_process_auth -a</p>
<p class="CodeGroup">$HOSTADDRESS$ $ARG1$ $ARG2$ $USER9$</p>
<p class="CodeGroup">}</p>
<p class="CodeGroup"># commands check_WMI_swap</p>
<p class="CodeGroup">define command {</p>
<p class="CodeGroup">command_name check_WMI_swap</p>
<p class="CodeGroup">command_line $USER1$/check_nrpe -H 192.168.1.243 -c check_swap_auth -a</p>
<p class="CodeGroup">$HOSTADDRESS$ $ARG1$ $ARG2$ $ARG3$ $USER9$</p>
<p class="CodeGroup">}</p>
<p class="CodeGroup">&#160;</p>
<p class="CodeGroup"># nagios-WMI-exchange-mailbox-receiveq check command definition</p>
<p class="CodeGroup">define command {</p>
<p class="CodeGroup">command_name check_WMI_exchange_mailbox_receiveq</p>
<p class="CodeGroup">command_line $USER1$/check_nrpe -H 192.168.1.243 -c check_exc_mbx_rcvq_auth -a</p>
<p class="CodeGroup">$HOSTADDRESS$ $ARG1$ $ARG2$ $ARG3$ $USER9$</p>
<p class="CodeGroup">}</p>
<p class="CodeGroup">&#160;</p>
<p class="CodeGroup"># nagios-WMI-exchange-mailbox-sendq check command definition</p>
<p class="CodeGroup">define command {</p>
<p class="CodeGroup">command_name check_WMI_exchange_mailbox_sendq</p>
<p class="CodeGroup">command_line $USER1$/check_nrpe -H 192.168.1.243 -c check_exc_mbx_sendq_auth -a</p>
<p class="CodeGroup">$HOSTADDRESS$ $ARG1$ $ARG2$ $ARG3$ $USER9$</p>
<p class="CodeGroup">}</p>
<p class="CodeGroup">&#160;</p>
<p class="CodeGroup"># commands check_WMI_exchange_mta_workq</p>
<p class="CodeGroup">define command {</p>
<p class="CodeGroup">command_name check_WMI_exchange_mta_workq</p>
<p class="CodeGroup">command_line $USER1$/check_nrpe -H 192.168.1.243 -c check_exc_mta_workq_auth -a</p>
<p class="CodeGroup">$HOSTADDRESS$ $ARG1$ $ARG2$ $ARG3$ $USER9$</p>
<p class="CodeGroup">}</p>
<p class="CodeGroup">&#160;</p>
<p class="CodeGroup"># commands check_WMI_exchange_public_recieveq</p>
<p class="CodeGroup">define command {</p>
<p class="CodeGroup">command_name check_WMI_exchange_public_receiveq</p>
<p class="CodeGroup">command_line $USER1$/check_nrpe -H 192.168.1.243 -c check_exc_pub_rcvq_auth -a</p>
<p class="CodeGroup">$HOSTADDRESS$ $ARG1$ $ARG2$ $ARG3$ $USER9$</p>
<p class="CodeGroup">}</p>
<p class="CodeGroup">&#160;</p>
<p class="CodeGroup"># commands check_WMI_exchange_public_sendq</p>
<p class="CodeGroup">define command {</p>
<p class="CodeGroup">command_name check_WMI_exchange_public_sendq</p>
<p class="CodeGroup">command_line $USER1$/check_nrpe -H 192.168.1.243 -c check_exc_pub_sendq_auth -a</p>
<p class="CodeGroup">$HOSTADDRESS$ $ARG1$ $ARG2$ $ARG3$ $USER9$</p>
<p class="CodeGroup">}</p>
<p class="CodeGroup">&#160;</p>
<p class="CodeGroup"># nagios-WMI-mssql-buffer-cache-hit check command definition</p>
<p class="CodeGroup">define command {</p>
<p class="CodeGroup">command_name check_WMI_mssql_buff_cache_hit</p>
<p class="CodeGroup">command_line $USER1$/check_nrpe -H 192.168.1.243 -c check_mssql_buf_cache_hit_auth -a</p>
<p class="CodeGroup">$HOSTADDRESS$ $ARG1$ $ARG2$ $ARG3$ $USER9$</p>
<p class="CodeGroup">}</p>
<p class="CodeGroup">&#160;</p>
<p class="CodeGroup"># nagios-WMI-mssql-latch-waits check command definition</p>
<p class="CodeGroup">define command {</p>
<p class="CodeGroup">command_name check_WMI_mssql_latch_waits</p>
<p class="CodeGroup">command_line $USER1$/check_nrpe -H 192.168.1.243 -c check_mssql_latch_waits_auth -a</p>
<p class="CodeGroup">$HOSTADDRESS$ $ARG1$ $ARG2$ $ARG3$ $USER9$</p>
<p class="CodeGroup">}</p>
<p class="CodeGroup">&#160;</p>
<p class="CodeGroup"># nagios-WMI-mssql-lock-wait-time check command definition</p>
<p class="CodeGroup">define command {</p>
<p class="CodeGroup">command_name check_WMI_mssql_lock_wait_time</p>
<p class="CodeGroup">command_line $USER1$/check_nrpe -H 192.168.1.243 -c check_mssql_lock_wait_time_auth -a</p>
<p class="CodeGroup">$HOSTADDRESS$ $ARG1$ $ARG2$ $ARG3$ $USER9$</p>
<p class="CodeGroup">}</p>
<p class="CodeGroup">&#160;</p>
<p class="CodeGroup"># nagios-WMI-mssql-log-growth check command definition</p>
<p class="CodeGroup">define command {</p>
<p class="CodeGroup">command_name check_WMI_mssql_log_growth</p>
<p class="CodeGroup">command_line $USER1$/check_nrpe -H 192.168.1.243 -c check_mssql_log_growth_auth -a</p>
<p class="CodeGroup">$HOSTADDRESS$ $ARG1$ $ARG2$ $ARG3$ $ARG4$ $USER9$</p>
<p class="CodeGroup">}</p>
<p class="CodeGroup">&#160;</p>
<p class="CodeGroup"># nagios-WMI-mssql-log-used check command definition</p>
<p class="CodeGroup">define command {</p>
<p class="CodeGroup">command_name check_WMI_mssql_log_used</p>
<p class="CodeGroup">command_line $USER1$/check_nrpe -H 192.168.1.243 -c check_mssql_log_used_auth -a</p>
<p class="CodeGroup">$HOSTADDRESS$ $ARG1$ $ARG2$ $ARG3$ $ARG4$ $USER9$</p>
<p class="CodeGroup">}</p>
<p class="CodeGroup">&#160;</p>
<p class="CodeGroup"># nagios-WMI-mssql-transactions check command definition</p>
<p class="CodeGroup">define command { command_name check_WMI_mssql_transactions</p>
<p class="CodeGroup">command_line $USER1$/check_nrpe -H 192.168.1.243 -c check_mssql_transactions_auth -a</p>
<p class="CodeGroup">$HOSTADDRESS$ $ARG1$ $ARG2$ $ARG3$ $ARG4$ $USER9$</p>
<p class="CodeGroup">}</p>
<div style="width: 100%; position: relative;" id="footer">
<p class="Footer" style="font-size: 7pt; line-height: Normal; margin-top: 6pt; margin-bottom: 4pt;">GroundWork, Inc. ©2011</p>
</div>
<script type="text/javascript" language="JavaScript">
//<![CDATA[
 if ((parseInt(navigator.appVersion) == 4) && (navigator.appName == 'Netscape'))
  document.write("<div id='tooltip' class='WebHelpPopupMenu'><\/div>");
//]]>
</script><script type="text/javascript" language="javascript1.2">
//<![CDATA[
<!--
if (window.writeIntopicBar)
        writeIntopicBar(0);


highlightSearch();
//-->
//]]>
</script>
</body>
</html>
