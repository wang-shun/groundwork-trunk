<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0014)about:internet -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="search-keywords" content="how to's" />
<meta http-equiv="Content-Language" content="en-US" />
<meta name="generator" content="Adobe RoboHelp 8" />
<title>Operational How To's</title>
<link rel="StyleSheet" href="../Bookshelf.css" type="text/css" />
<script type="text/javascript" language="JavaScript">
//<![CDATA[
function reDo() {
  if (innerWidth != origWidth || innerHeight != origHeight)
     location.reload();
}
if ((parseInt(navigator.appVersion) == 4) && (navigator.appName == "Netscape")) {
        origWidth = innerWidth;
        origHeight = innerHeight;
        onresize = reDo;
}
onerror = null; 
//]]>
</script>
<style type="text/css">
/*<![CDATA[*/
<!--
div.WebHelpPopupMenu { position:absolute;
left:0px;
top:0px;
z-index:4;
visibility:hidden; }
-->
/*]]>*/
</style>

<script type="text/javascript" language="javascript1.2" src="../whmsg.js">
</script>
<script type="text/javascript" language="javascript" src="../whver.js">
</script>
<script type="text/javascript" language="javascript1.2" src="../whproxy.js">
</script>
<script type="text/javascript" language="javascript1.2" src="../whutils.js">
</script>
<script type="text/javascript" language="javascript1.2" src="../whlang.js">
</script>
<script type="text/javascript" language="javascript1.2" src="../whtopic.js">
</script>
</head>
<body>
<script type="text/javascript" language="javascript1.2">
//<![CDATA[
<!--
if (window.gbWhTopic)
{
        var strUrl = document.location.href;
        var bc = 0;
        var n = strUrl.toLowerCase().indexOf("bc-");
        if(n != -1)
        {
                document.location.href = strUrl.substring(0, n);
                bc = strUrl.substring(n+3);
        }

        if (window.addTocInfo)
        {
        addTocInfo("USING APPLICATIONS\nOperational How To's");
addButton("show",BTN_TEXT,"Show Table of Contents","","","","",0,0,"","","");

        }
        if (window.writeBtnStyle)
                writeBtnStyle();

        if (window.writeIntopicBar)
                writeIntopicBar(1);

        
        

        if (window.setRelStartPage)
        {
        setRelStartPage("../Bookshelf.htm");

                autoSync(0);
                sendSyncInfo();
                sendAveInfoOut();
        }
}
else
        if (window.gbIE4)
                document.location.reload();

//-->
//]]>
</script><script type="text/javascript" language="javascript">
//<![CDATA[
document.write("<p  style=\"text-align:right;color:#0000ff;font-family:Arial;font-size:7pt;font-weight: normal;font-style: normal;text-decoration: none;\">");
AddMasterBreadcrumbs("../Bookshelf.htm", "color:#0000ff;font-family:Arial;font-size:7pt;font-weight: normal;font-style: normal;text-decoration: none;", "&gt;", "Home", "../Welcome_to_GroundWork_Monitor/index.htm");
document.write("<a style=\"color:#0000ff;font-family:Arial;font-size:7pt;font-weight: normal;font-style: normal;text-decoration: none;\" href=\"../Using_Applications/usingapplications_aboutusingapplications.htm\">USING APPLICATIONS<\/a> &gt; Operational How To's<\/p>");
//]]>
</script>
<p>&#160;</p>
<script src="../ehlpdhtm.js" type="text/javascript" language="JavaScript1.2">
</script>
<h1><a name="MiniTOCBookMark1" id="MiniTOCBookMark1"></a><img src="../Shared_Images/square.gif" alt="square.gif" style="border: none;" width="15" height="15" border="0" /> GroundWork Monitor Operational How To's</h1>
<h3 align="right"><a href="../Using_Applications/usingapplications_aboutusingapplications.htm" title="Topic Home" onmouseover="if ((parseInt(navigator.appVersion) == 4) &amp;&amp; (navigator.appName == 'Netscape')) ehlp_showtip(this,event,'Topic Home')" onmouseout="if ((parseInt(navigator.appVersion) == 4) &amp;&amp; (navigator.appName == 'Netscape')) ehlp_hidetip()" style="font-size: 9pt;"><img src="../Shared_Images/homeicon.gif" alt="homeicon.gif" style="border: none;" width="33" height="27" border="0" /></a> <img src="../Shared_Images/printicon.gif" onclick="window.print()" alt="Print Page" title="Print Page" style="border: none;" width="31" height="27" border="0" /> <a href="mailto:support@groundworkopensource.com?subject=Operational How To's" title="Send Comments" style="font-size: 9pt;"><img src="../Shared_Images/commentsicon.gif" alt="commentsicon.gif" style="border: none;" width="33" height="27" border="0" /></a></h3>
<span class="PageTitle">Operational How To's</span>
<p>This page offers various <span style="font-style: italic;"><i>GroundWork Monitor Operational How To's</i></span>. This list is in continuous development, please select the <span style="font-style: italic;"><i>mail</i></span> icon link above to send comments and suggestions. See <img src="../Shared_Images/gray_book_open.gif" alt="gray_book_open.gif" style="border: none;" width="17" height="15" border="0" />USING APPLICATIONS in the Bookshelf navigation tree for details on specific <span style="font-style: italic;"><i>GroundWork Monitor</i></span> portal pages and operations.</p>
<p align="left">Table&#160;of&#160;Contents:&#160;<a class="dropspot" href="javascript:TextPopup(this)" id="MTHotSpot25976" name="MTHotSpot25976"><span class="MTText" style="display: none;">Show</span><span class="MTText">Hide</span></a></p>
<script type="text/javascript" language="JavaScript1.2">
//<![CDATA[
TextPopupInit('MTHotSpot25976', 'MTPOPUP25976');
//]]>
</script>
<div align="left" class="droptext" id="MTPOPUP25976">
<ul style="text-align:left; list-style-type: circle;">
<li><a href="#MiniTOCBookMark2">Configuration</a>
<ul style="list-style-type: circle;">
<li><a href="#MiniTOCBookMark3">How to cancel a scheduled downtime</a></li>
<li><a href="#MiniTOCBookMark4">How to work with escaping $ in NRPE service arguments</a></li>
</ul>
</li>
<li><a href="#MiniTOCBookMark7">GroundWork Monitor</a>
<ul style="list-style-type: circle;">
<li><a href="#MiniTOCBookMark8">How to find what version of GroundWork Monitor is running</a></li>
<li><a href="#MiniTOCBookMark9">How to find what versions of Nagios and Monarch are running</a></li>
<li><a href="#MiniTOCBookMark10">How to stop and start GroundWork Monitor services</a></li>
<li><a href="#MiniTOCBookMark15">How to configure GroundWork Monitor to allow access to the Nagios WAP Interface</a></li>
<li><a href="#MiniTOCBookMark16">How to change the GroundWork Monitor portal timeout parameter</a></li>
</ul>
</li>
<li><a href="#MiniTOCBookMark17">Log Files</a>
<ul style="list-style-type: circle;">
<li><a href="#MiniTOCBookMark18">How to audit Monarch Commit operations</a></li>
</ul>
</li>
<li><a href="#MiniTOCBookMark25">LDAP Authentication Configuration</a>
<ul style="list-style-type: circle;">
<li><a href="#MiniTOCBookMark26">How to integrate with Active Directory, OpenLDAP, and LDAPs</a></li>
</ul>
</li>
<li><a href="#MiniTOCBookMark43">PostgreSQL</a>
<ul style="list-style-type: circle;">
<li><a href="#MiniTOCBookMark44">How to reset my PostgreSQL root user password</a></li>
<li><a href="#MiniTOCBookMark45">How to restore a backup of the monarch database</a></li>
</ul>
</li>
<li><a href="#MiniTOCBookMark46">Network Service</a>
<ul style="list-style-type: circle;">
<li><a href="#MiniTOCBookMark47">How to configure a proxy server</a></li>
</ul>
</li>
<li><a href="#MiniTOCBookMark48">Performance Graphs</a>
<ul style="list-style-type: circle;">
<li><a href="#MiniTOCBookMark49">How to troubleshoot performance graphs</a></li>
<li><a href="#MiniTOCBookMark50">How to enable performance eventhandler logging</a></li>
<li><a href="#MiniTOCBookMark51">How to remove hosts from the performance screen</a></li>
</ul>
</li>
<li><a href="#MiniTOCBookMark52">Reports</a>
<ul style="list-style-type: circle;">
<li><a href="#MiniTOCBookMark53">How to see data for Availability Reports after installation</a></li>
</ul>
</li>
<li><a href="#MiniTOCBookMark54">Status Connection Protocols</a>
<ul style="list-style-type: circle;">
<li><a href="#MiniTOCBookMark55">How to define URLs for the Actions portlet Connections menu</a></li>
</ul>
</li>
<li><a href="#MiniTOCBookMark56">SSL</a>
<ul style="list-style-type: circle;">
<li><a href="#MiniTOCBookMark57">How to enable HTTPS (SSL) support for Apache</a></li>
</ul>
</li>
</ul>
</div>
<h2><a name="MiniTOCBookMark2" id="MiniTOCBookMark2"></a>Configuration</h2>
<h3><a name="MiniTOCBookMark3" id="MiniTOCBookMark3"></a>How to cancel a scheduled downtime</h3>
<p><span style="font-style: italic;"><i><a class="dropspot" href="javascript:TextPopup(this)" id="a2" style="font-size: 8pt;" name="a2"><img src="../Shared_Images/screenshoticon.gif" title="View Screenshot" alt="screenshoticon.gif" style="border: none;" width="29" height="27" border="0" />Show/Hide</a></i></span> Follow the steps below to cancel a scheduled downtime through the <i>Nagios</i> interface.</p>
<div class="droptext" id="POPUP383060338" style="display: none;">
<p class="Caption" style="margin-left: 0px; font-size: 7pt;">Figure: Cancel Scheduled Downtime for Hosts and Services</p>
<p class="Figure"><img src="Assets/howtos_cancelscheduleddowntime.gif" alt="howtos_cancelscheduleddowntime.gif" style="border: none;" width="600" height="208" border="0" /></p>
</div>
<ol style="font-size: 9pt;">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Select the <span style="font-weight: bold;"><b>Nagios</b></span> page.</p>
</li>
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Select <span style="font-weight: bold;"><b>Scheduled Downtime</b></span>.</p>
</li>
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Find the problem <span style="font-weight: bold;"><b>Host</b></span>/<span style="font-weight: bold;"><b>Service</b></span> and click the corresponding <span style="font-weight: bold;"><b>trash can</b></span> on the right side under <span style="font-style: italic;"><i>Actions</i></span> column to delete downtime scheduled.</p>
</li>
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Click <span style="font-weight: bold;"><b>Commit</b></span> and <span style="font-weight: bold;"><b>Done</b></span>.</p>
</li>
</ol>
<h3 class="Numbering"><a name="MiniTOCBookMark4" id="MiniTOCBookMark4"></a>How to work with escaping $ in NRPE service arguments</h3>
<p>If you are using <span style="font-style: italic;"><i>WMI Proxy</i></span> to check for a <span style="font-style: italic;"><i>Microsoft Service</i></span> running on a <span style="font-style: italic;"><i>Host</i></span> you can employ the check for the <span style="font-style: italic;"><i>Service</i></span> that passes in the <span style="font-style: italic;"><i>Service Name</i></span> and possibly the <span style="font-style: italic;"><i>user/password</i></span> credentials. But if the <span style="font-style: italic;"><i>Service Name</i></span> on the <span style="font-style: italic;"><i>Microsoft Host</i></span> has an embedded <span style="font-style: italic;"><i>$</i></span> character this will not work unless you properly escape the <span style="font-style: italic;"><i>$</i></span>.</p>
<h4><a name="MiniTOCBookMark5" id="MiniTOCBookMark5"></a>Example Scenario:</h4>
<p>Checking for <span style="font-style: italic;"><i>MSSQLSERVER</i></span> Microsoft just said <span style="font-style: italic;"><i>no such name</i></span>. A quick run of <span style="font-style: italic;"><i>PSTools</i></span> <span style="font-style: italic;"><i>psservice</i></span> command revealed the services were running under a different set of names. These names had the form of <span style="font-style: italic;"><i>MSSQL$EFGH</i></span>. Putting this into the standard check with the Monarch Configuration tool resulted in a status of <span style="font-style: italic;"><i>Unknown - MSSQL: not installed</i></span>.</p>
<p>The key information is to use a <span style="font-style: italic;"><i>\$$</i></span> to create something that <span style="font-style: italic;"><i>Nagios</i></span> (and <span style="font-style: italic;"><i>NRPE_NT</i></span>) will interpret as a single <span style="font-style: italic;"><i>$</i></span> in the middle of some other text. If you don't do this, <span style="font-style: italic;"><i>Nagios</i></span> will interpret the <span style="font-style: italic;"><i>$</i></span> and the trailing characters (and later <span style="font-style: italic;"><i>$</i></span> characters) as some kind of outer space macro. You may be confused because the <span style="font-style: italic;"><i>Monarch Configuration</i></span> <span style="font-style: italic;"><i>Test</i></span> feature will produce a working result without this sequence, yet paradoxically <span style="font-style: italic;"><i>Nagios</i></span> does not like the generated config files.</p>
<h4><a name="MiniTOCBookMark6" id="MiniTOCBookMark6"></a>Example:</h4>
<ul>
<li class="P-Bullet1">
<p class="Bullet1"><span style="font-weight: bold;"><b>WMI Proxy IP address</b></span> (first we'll just pass it as an argument):</p>
</li>
</ul>
<p class="GroupCode2">10.10.10.1</p>
<ul>
<li class="P-Bullet1">
<p class="Bullet1"><span style="font-weight: bold;"><b>Microsoft Service Name</b></span>:</p>
</li>
</ul>
<p class="GroupCode2">MSSQL$CVP1SQL</p>
<ul>
<li class="P-Bullet1">
<p class="Bullet1">A basic <span style="font-style: italic;"><i>Monarch Configuration</i></span> check command assumes the <span style="font-style: italic;"><i>WMI Proxy</i></span> account has rights to do the check.</p>
</li>
<li class="P-Bullet1">
<p class="Bullet1"><span style="font-weight: bold;"><b>Check Command Name</b></span>:</p>
</li>
</ul>
<p class="GroupCode2"><span style="font-style: italic;"><i>check_wmi_service</i></span></p>
<ul>
<li class="P-Bullet1">
<p class="Bullet1"><span style="font-weight: bold;"><b>Command Line</b></span><span style="font-style: italic;"><i>:</i></span></p>
</li>
</ul>
<p class="GroupCode2">$USER1$/check_nrpe -H $ARG1$ -t 60 -c get_service -a "$HOSTADDRESS$" $ARG2$</p>
<ul>
<li class="P-Bullet1">
<p class="Bullet1"><span style="font-weight: bold;"><b>Monarch Service Name Command Line</b></span><span style="font-style: italic;"><i>:</i></span></p>
</li>
</ul>
<p class="GroupCode2"><span class="CodeInline">check_wmi_service_auth!10.10.10.1!MSSQL\$$CVP1SQL</span></p>
<ul>
<li class="P-Bullet1">
<p class="Bullet1">Looking at the generated <span class="CodeInline">service.cfg</span> and you see:</p>
</li>
</ul>
<p class="GroupCode2"><span class="CodeInline">check_command check_wmi_service_auth!10.21.130.80!MSSQL\$$CVP1SQL</span></p>
<h2><a name="MiniTOCBookMark7" id="MiniTOCBookMark7"></a>GroundWork Monitor</h2>
<h3><a name="MiniTOCBookMark8" id="MiniTOCBookMark8"></a>How to find what version of GroundWork Monitor is running</h3>
<p><span style="font-style: italic;"><i><a class="dropspot" href="javascript:TextPopup(this)" id="a1" style="font-size: 8pt;" name="a1"><img src="../Shared_Images/screenshoticon.gif" title="View Screenshot" alt="screenshoticon.gif" style="border: none;" width="29" height="27" border="0" />Show/Hide</a></i></span> After logging into <i>GroundWork Monitor</i> the default <i>Dashboard</i> will be displayed. This dashboard displays general information on <i>Notifications</i> and a <i>GroundWork Installation Report</i> which provides the installation name and date, and component versions. The <i>NetworkServicePlugin</i> portlet instance is used in this dashboard to provide this information.</p>
<div class="droptext" id="POPUP390567251" style="display: none;">
<p class="Caption" style="margin-left: 0px; font-size: 7pt;">Figure: GroundWork Monitor Version</p>
<p class="Figure"><img src="Assets/howtos_version.gif" alt="howtos_version.gif" style="border: none;" width="600" height="368" border="0" /></p>
</div>
<h3><a name="MiniTOCBookMark9" id="MiniTOCBookMark9"></a>How to find what versions of Nagios and Monarch are running</h3>
<p><span style="font-style: italic;"><i><a class="dropspot" href="javascript:TextPopup(this)" id="a3" style="font-size: 8pt;" name="a3"><img src="../Shared_Images/screenshoticon.gif" title="View Screenshot" alt="screenshoticon.gif" style="border: none;" width="29" height="27" border="0" />Show/Hide</a></i></span> Follow the steps below to view the current <i>Nagios</i> and <i>Monarch</i> versions.</p>
<div class="droptext" id="POPUP378410614" style="display: none;">
<p class="Caption" style="margin-left: 0px; font-size: 7pt;">Figure: Configuration Setup</p>
<p class="Figure"><img src="Assets/howtos_versionofnagiosandmonarch.gif" alt="howtos_versionofnagiosandmonarch.gif" style="border: none;" width="600" height="245" border="0" /></p>
</div>
<ol style="font-size: 9pt;">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Select the <span style="font-weight: bold;"><b>Configuration</b></span> application tab.</p>
</li>
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Select the <span style="font-weight: bold;"><b>Control</b></span> option.</p>
</li>
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Select <span style="font-weight: bold;"><b>Setup</b></span> option. The current Monarch and Nagios versions will be displayed.</p>
</li>
</ol>
<h3><a name="MiniTOCBookMark10" id="MiniTOCBookMark10"></a>How to stop and start GroundWork Monitor services</h3>
<p><font color="#FF0000"><b style="font-weight: bold;">Note:</b></font> Restarting gwservices or other GroundWork Monitor services may make UI components unresponsive in the browser.</p>
<h4><a name="MiniTOCBookMark11" id="MiniTOCBookMark11"></a>About UI Components Using Web Services</h4>
<p>In most cases, stopping and starting any of the services is not advised. These services are interdependent upon one another. In this release, gwservices runs and controls the entire middleware that includes the different feeders, the data integration engine and the Web Service layer that drives the UI. It is not advised to just restart the gwservices service since it puts UI components consuming Web Services into an unknown state and the components may no longer respond in the browser. Some examples of these components are Status, Dashboards, and Event Console.</p>
<p>When these services are randomly started, the other services will be placed into unknown states. If you must stop and start one of these services have all users log out of the server first. Moreover in most cases, if an administrator needs to stop one of these services, the safest course of action is to stop all the services and start them again thereby allowing all the <span style="font-style: italic;"><i>GroundWork Monitor</i></span> services to re-synchronize with one another.</p>
<h4><a name="MiniTOCBookMark12" id="MiniTOCBookMark12"></a>GroundWork Monitor Enterprise</h4>
<h5><a name="MiniTOCBookMark13" id="MiniTOCBookMark13"></a>Stopping the Services</h5>
<ul style="font-size: 9pt;">
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1">Stop Apache2: <span class="CodeInline"><font><b style="font-weight: bold; font-size: 9pt;">/usr/local/groundwork/ctlscript.sh stop apache</b></font></span></p>
</li>
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1">Stop SNMP Trap Translator: <span class="CodeInline"><font><b style="font-weight: bold; font-size: 9pt;">/usr/local/groundwork/ctlscript.sh stop snmptt</b></font></span></p>
</li>
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1">Stop Nagios: <span class="CodeInline"><font><b style="font-weight: bold; font-size: 9pt;">/usr/local/groundwork/ctlscript.sh stop nagios</b></font></span></p>
</li>
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1">Stop Foundation: <span class="CodeInline"><font><b style="font-weight: bold; font-size: 9pt;">/usr/local/groundwork/ctlscript.sh stop gwservices</b></font></span></p>
</li>
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1">Stop syslog-ng: <span class="CodeInline"><font><b style="font-weight: bold; font-size: 9pt;">/usr/local/groundwork/ctlscript.sh stop syslog-ng</b></font></span></p>
</li>
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1">Stop network-service: <span class="CodeInline"><font color="#009B00"><b style="font-weight: bold; font-size: 9pt;">/usr/local/groundwork/ctlscript.sh stop network-service</b></font></span></p>
</li>
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1">Stop PostgreSQL : <span class="CodeInline"><b style="font-weight: bold; font-size: 9pt;">/usr/local/groundwork/ctlscript.sh stop postgresql</b></span></p>
</li>
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1">Stop snmptrapd: <span class="CodeInline"><font><b style="font-weight: bold; font-size: 9pt;">/usr/local/groundwork/ctlscript.sh stop snmptrapd</b></font></span></p>
</li>
</ul>
<h5><a name="MiniTOCBookMark14" id="MiniTOCBookMark14"></a>Starting the Services</h5>
<ul style="font-size: 9pt;">
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1">Start Apache2: <span class="CodeInline"><font><b style="font-weight: bold; font-size: 9pt;">/usr/local/groundwork/ctlscript.sh start apache</b></font></span></p>
</li>
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1">Start SNMP Trap Translator: <span class="CodeInline"><font><b style="font-weight: bold; font-size: 9pt;">/usr/local/groundwork/ctlscript.sh start snmptt</b></font></span></p>
</li>
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1">Start Nagios: <span class="CodeInline"><font><b style="font-weight: bold; font-size: 9pt;">/usr/local/groundwork/ctlscript.sh start nagios</b></font></span></p>
</li>
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1">Start Foundation: <span class="CodeInline"><font><b style="font-weight: bold; font-size: 9pt;">/usr/local/groundwork/ctlscript.sh start gwservices</b></font></span></p>
</li>
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1">Start syslog-ng: <span class="CodeInline"><font><b style="font-weight: bold; font-size: 9pt;">/usr/local/groundwork/ctlscript.sh start syslog-ng</b></font></span></p>
</li>
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1">Start network-service: <span class="CodeInline"><font><b style="font-weight: bold; font-size: 9pt;">/usr/local/groundwork/ctlscript.sh start network-service</b></font></span></p>
</li>
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1">Start PostgreSQL: <span class="CodeInline"><b style="font-weight: bold; font-size: 9pt;">/usr/local/groundwork/ctlscript.sh start postgresql</b></span></p>
</li>
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1">Start snmptrapd:<span class="CodeInline"><font><b style="font-weight: bold; font-size: 9pt;">/usr/local/groundwork/ctlscript.sh start snmptrapd</b></font></span></p>
</li>
</ul>
<h3><a name="MiniTOCBookMark15" id="MiniTOCBookMark15"></a>How to configure GroundWork Monitor to allow access to the Nagios WAP Interface</h3>
<p>In the <span style="font-style: italic;"><i>GroundWork</i></span> implementation, access to the <span style="font-style: italic;"><i>Nagios</i></span> CGIs is restricted to users who have first authenticated with the <span style="font-style: italic;"><i>GroundWork</i></span> portal.</p>
<p>This is a problem when attempting to access the system from a WAP enabled cell phone. Since the portal doesn’t support WAP, there is no way for a WAP device to authenticate.</p>
<p>The script referenced below can be executed as user <span class="CodeInline"><font style="font-size: 9pt;" size="2">nagios</font></span> or <span class="CodeInline"><font style="font-size: 9pt;" size="2">root</font></span> to reconfigure GroundWork Monitor appropriately, removing the <span class="CodeInline"><font style="font-size: 9pt;" size="2">statuswml.cgi</font></span> (the Nagios CGI that controls the WAP interface) from the portal authentication and making it externally accessible.</p>
<ol style="font-size: 9pt;">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Download: <b style="font-weight: normal;"><a href="Assets/install_wap_interface.sh" target="_blank" style="font-size: 9pt;">Install WAP Interface script</a></b></p>
</li>
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">After running the script you must restart Apache as user <span class="CodeInline"><font style="font-size: 9pt;" size="2">root</font></span>: /etc/init.d/httpd restart</p>
</li>
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Finally, in order to authenticate to the WAP interface, you must set at least one username and password. There is already an existing default user created. All you have to do is update the password as user <span class="CodeInline">nagios</span> or <span class="CodeInline">root</span> with the following command, typing in a new password when prompted:</p>
</li>
</ol>
<p class="GroupCode2">cd /usr/local/groundwork/apache2/bin</p>
<p class="GroupCode2">./htpasswd /usr/local/groundwork/nagios/etc/htpasswd.users nagiosadmin</p>
<ol start="4" style="font-size: 9pt;" type="1">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">You should now be able to pull up the following URL on your GroundWork server:</p>
</li>
</ol>
<p class="GroupCode2"><span class="CodeInline">/exposed/cgi-bin/statuswml.cgi</span></p>
<ol start="5" style="font-size: 9pt;">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">You will be challenged with the <span class="CodeInline"><font style="font-size: 9pt;" size="2">.htaccess</font></span> method configured by default. The CGI will only render in a WAP compliant browser.</p>
</li>
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Of course, you can add users to the <span class="CodeInline"><font style="font-size: 9pt;" size="2">cgi.cfg</font></span> and the <span class="CodeInline"><font style="font-size: 9pt;" size="2">.htpasswd</font></span> files, as documented in Nagios documentation, if you wish to use this facility to secure the WAP interface.</p>
</li>
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">It will be necessary to expose this URL to the Internet to allow mobile devices to reach it, but this isn't a matter GroundWork can control.</p>
</li>
</ol>
<h3><a name="MiniTOCBookMark16" id="MiniTOCBookMark16"></a>How to change the GroundWork Monitor portal timeout parameter</h3>
<p>If the <i>GroundWork Monitor</i> portal page is left open for a long period of time, a permissions error will eventually be displayed. The JBoss portal has a set timeout limit of 7 hours. This value can be changed with the process outlined below. Note: This process is disruptive to the GroundWork Monitor server. You should have users logged off to this server before making changes.</p>
<ol style="font-size: 9pt;">
<li class="P-Numbering" style="font-size: 9pt; font-weight: normal;">
<p class="Numbering" style="font-weight: normal;">The timeout value can be change in the file:</p>
</li>
</ol>
<p class="GroupCode2">/usr/local/groundwork/foundation/container/webapps/jboss/jboss-portal.sar/portal-server.war/WEB-INF/web.xml</p>
<ol start="2" style="font-size: 9pt;" type="1">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">The snip that needs to be modified is:</p>
</li>
</ol>
<p class="GroupCode2">&lt;!-- Set the portal timeout to 7 hours --&gt;</p>
<p class="GroupCode2">&lt;session-config&gt;&lt;session-timeout&gt;420&lt;/session-timeout&gt;&lt;/session-config&gt;</p>
<ol start="3" style="font-size: 9pt;" type="1">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Save your changes and restart <span style="font-style: italic;"><i>gwservices</i></span>;</p>
</li>
</ol>
<p class="GroupCode2">/usr/local/groundwork/ctlscript.sh restart gwservices</p>
<h2><a name="MiniTOCBookMark17" id="MiniTOCBookMark17"></a>Log Files</h2>
<h3><a name="MiniTOCBookMark18" id="MiniTOCBookMark18"></a>How to audit Monarch Commit operations</h3>
<p>Customers require that changes to the configuration of <span style="font-style: italic;"><i>Nagios</i></span> be logged.&#160;The <span style="font-style: italic;"><i>Monarch</i></span> tool is used to make changes to the configuration of <span style="font-style: italic;"><i>Nagios</i></span> and when the user of <span style="font-style: italic;"><i>Monarch</i></span> wishes these changes to be pushed to <span style="font-style: italic;"><i>Nagios</i></span> a <span style="font-style: italic;"><i>commit</i></span> operation is done. As part of the commit operation the timestamp at which the commit is done and the name of the user performing the commit are written into the main <span style="font-style: italic;"><i>Nagios</i></span> configuration file. This is also true in the case of <span style="font-style: italic;"><i>Monarch Groups</i></span> when a build Instance is done.</p>
<p><i style="font-style: italic;">GroundWork</i> is providing this document to allow customers to add auditing of Commit operations by logging the timestamp and name of the user performing Commits and Build Instance operations to the <span style="font-style: italic;"><i>Event Console</i></span>.</p>
<p>A new Application Type <span style="font-style: italic;"><i>AUDIT</i></span> is created in the <span style="font-style: italic;"><i>Event Console</i></span> and the <span style="font-style: italic;"><i>GroundWork Reports Event History</i></span> (gw-event-history) report can be used by the customer to list all audit events.</p>
<h4><a name="MiniTOCBookMark19" id="MiniTOCBookMark19"></a>Prerequisites</h4>
<p class="PopText" style="margin-left: 0px; font-size: 9pt;">These instructions will work on an install of GroundWork Monitor <span style="font-style: italic;"><i>Enterprise</i></span> or <span style="font-style: italic;"><i>Professional</i></span> 5.2.0 or later.</p>
<h4><a name="MiniTOCBookMark20" id="MiniTOCBookMark20"></a>Installation</h4>
<p>As user <span style="font-style: italic;"><i>nagios</i></span> on the <i>GroundWork</i> server perform the following steps:</p>
<ol style="font-size: 9pt;">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Place the contents of <i>Appendix A</i> (shown below) into a file:</p>
</li>
</ol>
<p class="GroupCode2"><b style="font-weight: bold;"><span class="CodeInline">/usr/local/groundwork/core/migration/add_audit_application_type.pl</span></b></p>
<ol start="2" style="font-size: 9pt;" type="1">
<li class="P-Numbering">
<p class="Numbering">Execute the following commands:</p>
</li>
</ol>
<p class="GroupCode2"><b style="font-weight: bold;"><span class="CodeInline">cd /usr/local/groundwork/core/migration</span></b></p>
<p class="GroupCode2"><b style="font-weight: bold;"><span class="CodeInline">chmod 744 add_audit_application_type.pl</span></b></p>
<p class="GroupCode2"><b style="font-weight: bold;"><span class="CodeInline">./add_audit_application_type.pl</span></b></p>
<ol start="3" type="1">
<li class="P-Numbering">
<p class="Numbering">Place the contents of <span style="font-style: italic;"><i>Appendix B</i></span> into a file:</p>
</li>
</ol>
<p class="GroupCode2"><b style="font-weight: bold;"><span class="CodeInline">/usr/local/groundwork/foundation/feeder/audit-nagios.pl</span></b></p>
<ol start="4" type="1">
<li class="P-Numbering">
<p class="Numbering">Execute the following commands:</p>
</li>
</ol>
<p class="GroupCode2"><b style="font-weight: bold;"><span class="CodeInline">cd /usr/local/groundwork/foundation/feeder</span></b></p>
<p class="GroupCode2"><b style="font-weight: bold;"><span class="CodeInline">chmod 744 audit-nagios.pl</span></b></p>
<p class="GroupCode2"><b style="font-weight: bold;"><span class="CodeInline">/usr/local/groundwork/common/bin/mkservice nagios nagios /usr/local/groundwork/core/services/feeder-nagios-audit</span></b></p>
<ol start="5" type="1">
<li class="P-Numbering">
<p class="Numbering">Place the contents of <span style="font-style: italic;"><i>Appendix C</i></span> into a file:</p>
</li>
</ol>
<p class="GroupCode2"><b style="font-weight: bold;"><span class="CodeInline">/usr/local/groundwork/core/services/feeder-nagios-audit/run</span></b></p>
<ol start="6" type="1">
<li class="P-Numbering">
<p class="Numbering">Append the contents of <span style="font-style: italic;"><i>Appendix D</i></span> to syslog-ng.conf:</p>
</li>
</ol>
<p class="GroupCode2"><b style="font-weight: bold;"><span class="CodeInline">/usr/local/groundwork/common/etc/syslog-ng.conf</span></b></p>
<p>As user <span style="font-style: italic;"><i>root</i></span> on the <span style="font-style: italic;"><i>GroundWork</i></span> server perform the following steps:</p>
<ol style="font-size: 9pt;">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Restart syslog:</p>
</li>
</ol>
<p class="GroupCode2"><b style="font-weight: bold;"><span class="CodeInline">/usr/local/groundwork/ctlscript.sh restart syslog-ng</span></b></p>
<ol start="2" style="font-size: 9pt;" type="1">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Restart GroundWork Services:</p>
</li>
</ol>
<p class="GroupCode2"><b style="font-weight: bold;"><span class="CodeInline">/usr/local/groundwork/ctlscript.sh restart gwservices</span></b></p>
<h4><a name="MiniTOCBookMark21" id="MiniTOCBookMark21"></a>Appendix A: add_audit_application_type.pl</h4>
<p class="CodeGroup">#!/usr/local/groundwork/perl/bin/perl -w --</p>
<p class="CodeGroup">#</p>
<p class="CodeGroup"># Database updater for audit logging within GroundWork Monitor</p>
<p class="CodeGroup">#</p>
<p class="CodeGroup"># Original version by Dr. Dave Blunt.</p>
<p class="CodeGroup"># Now modified for use with PostgreSQL.</p>
<p class="CodeGroup">#</p>
<p class="CodeGroup"># Last modified: 2011-11-09</p>
<p class="CodeGroup">#</p>
<p class="CodeGroup"># Usage: add_audit_application_type.pl</p>
<p class="CodeGroup">#</p>
<p class="CodeGroup"># Description:</p>
<p class="CodeGroup">#</p>
<p class="CodeGroup"># This script will access the GWCollageDB database based on the settings</p>
<p class="CodeGroup"># determined with the CollageQuery methods. &#160;Thus, the script must be run</p>
<p class="CodeGroup"># on the relevant GroundWork server.</p>
<p class="CodeGroup">#</p>
<p class="CodeGroup"># It will add rows to the ApplicationType, ConsolidationCriteria and</p>
<p class="CodeGroup"># ApplicationEntityProperty tables to support delivery and reporting on</p>
<p class="CodeGroup"># audit messages supplied by an external script 'audit-nagios.pl' that</p>
<p class="CodeGroup"># watches for commit operations on the Monarch database.</p>
<p class="CodeGroup">&#160;</p>
<p class="CodeGroup">use strict;</p>
<p class="CodeGroup">use DBI;</p>
<p class="CodeGroup">use CollageQuery;</p>
<p class="CodeGroup">&#160;</p>
<p class="CodeGroup">my ( $dbname, $dbhost, $dbuser, $dbpass, $dbtype ) = CollageQuery::readGroundworkDBConfig('collage');</p>
<p class="CodeGroup">my $dsn = ''</p>
<p class="CodeGroup">&#160;if ( defined($dbtype) &amp;&amp; $dbtype eq 'postgresql' ) {</p>
<p class="CodeGroup">&#160;&#160;&#160;&#160;&#160;$dsn = "DBI:Pg:dbname=$dbname;host=$dbhost";</p>
<p class="CodeGroup">}</p>
<p class="CodeGroup">else {</p>
<p class="CodeGroup">&#160;&#160;&#160;&#160;&#160;$dsn = "DBI:mysql:database=$dbname;host=$dbhost";</p>
<p class="CodeGroup">}</p>
<p class="CodeGroup">my $dbh = DBI-&gt;connect( $dsn, $dbuser, $dbpass, { 'AutoCommit' =&gt; 1 } )</p>
<p class="CodeGroup">&#160;&#160;&#160;&#160;&#160;or die "Cannot connect to database $dbname. Error: " . $DBI::errstr;</p>
<p class="CodeGroup">my $query;</p>
<p class="CodeGroup">my $sth;</p>
<p class="CodeGroup">&#160;</p>
<p class="CodeGroup"># Add the AUDIT application type.</p>
<p class="CodeGroup">$query = "insert into ApplicationType values(DEFAULT,'AUDIT','Audit logs for GroundWork Monitor','Device')";</p>
<p class="CodeGroup">$sth &#160;&#160;= $dbh-&gt;prepare($query);</p>
<p class="CodeGroup">$sth-&gt;execute() or die $@;</p>
<p class="CodeGroup">$sth-&gt;finish();</p>
<p class="CodeGroup">&#160;</p>
<p class="CodeGroup"># Get back the AUDIT ApplicationTypeID for later reference.</p>
<p class="CodeGroup">$query = "select ApplicationTypeID as \"ApplicationTypeID\" from ApplicationType where Name='AUDIT'";</p>
<p class="CodeGroup">$sth &#160;&#160;= $dbh-&gt;prepare($query);</p>
<p class="CodeGroup">$sth-&gt;execute() or die $@;</p>
<p class="CodeGroup">my $appID;</p>
<p class="CodeGroup">while ( my $row = $sth-&gt;fetchrow_hashref() ) {</p>
<p class="CodeGroup">&#160;&#160;&#160;&#160;&#160;$appID = $$row{ApplicationTypeID}; }</p>
<p class="CodeGroup">$sth-&gt;finish();</p>
<p class="CodeGroup">&#160;</p>
<p class="CodeGroup"># Add the Consolidation criteria for AUDIT messages.</p>
<p class="CodeGroup">$query = "insert into ConsolidationCriteria values(DEFAULT,'AUDIT','OperationStatus;Device;MonitorStatus;ipaddress;ErrorType;SubComponent')";</p>
<p class="CodeGroup">$sth &#160;&#160;= $dbh-&gt;prepare($query);</p>
<p class="CodeGroup">$sth-&gt;execute() or die $@;</p>
<p class="CodeGroup">$sth-&gt;finish();</p>
<p class="CodeGroup">&#160;</p>
<p class="CodeGroup"># Add the ApplicationEntityProperty settings that control what is displayed in the NOC Console.</p>
<p class="CodeGroup">&#160;</p>
<p class="CodeGroup">$query = "select EntityTypeID as \"EntityTypeID\" from EntityType where Name='LOG_MESSAGE'";</p>
<p class="CodeGroup">$sth &#160;&#160;= $dbh-&gt;prepare($query);</p>
<p class="CodeGroup">$sth-&gt;execute() or die $@;</p>
<p class="CodeGroup">my $enttypeID;</p>
<p class="CodeGroup">while ( my $row = $sth-&gt;fetchrow_hashref() ) {</p>
<p class="CodeGroup">&#160;&#160;&#160;&#160;&#160;$enttypeID = $$row{EntityTypeID};</p>
<p class="CodeGroup">}</p>
<p class="CodeGroup">$sth-&gt;finish();</p>
<p class="CodeGroup">&#160;</p>
<p class="CodeGroup">$query = "select PropertyTypeID as \"PropertyTypeID\", Name as \"Name\" from PropertyType";</p>
<p class="CodeGroup">$sth &#160;&#160;= $dbh-&gt;prepare($query);</p>
<p class="CodeGroup">$sth-&gt;execute() or die $@;</p>
<p class="CodeGroup">my %proptypeID;</p>
<p class="CodeGroup">while ( my $row = $sth-&gt;fetchrow_hashref() ) {</p>
<p class="CodeGroup">&#160;&#160;&#160;&#160;&#160;$proptypeID{ $$row{Name} } = $$row{PropertyTypeID};</p>
<p class="CodeGroup">}</p>
<p class="CodeGroup">$sth-&gt;finish();</p>
<p class="CodeGroup">&#160;</p>
<p class="CodeGroup">$query = "insert into ApplicationEntityProperty values(DEFAULT,'$appID','$enttypeID','$proptypeID{SubComponent}','2')";</p>
<p class="CodeGroup">$sth &#160;&#160;= $dbh-&gt;prepare($query);</p>
<p class="CodeGroup">$sth-&gt;execute() or die $@;</p>
<p class="CodeGroup">$sth-&gt;finish();</p>
<p class="CodeGroup">&#160;</p>
<p class="CodeGroup">$query = "insert into ApplicationEntityProperty values(DEFAULT,'$appID','$enttypeID','$proptypeID{ErrorType}','3')";</p>
<p class="CodeGroup">$sth &#160;&#160;= $dbh-&gt;prepare($query);</p>
<p class="CodeGroup">$sth-&gt;execute() or die $@;</p>
<p class="CodeGroup">$sth-&gt;finish();</p>
<p class="CodeGroup">&#160;</p>
<p class="CodeGroup">$query = "insert into ApplicationEntityProperty values(DEFAULT,'$appID','$enttypeID','$proptypeID{ipaddress}','1')";</p>
<p class="CodeGroup">$sth &#160;&#160;= $dbh-&gt;prepare($query);</p>
<p class="CodeGroup">$sth-&gt;execute() or die $@;</p>
<p class="CodeGroup">$sth-&gt;finish();</p>
<p class="CodeGroup">&#160;</p>
<p class="CodeGroup">$dbh-&gt;disconnect();</p>
<p class="CodeGroup">print "Database update completed.\n";</p>
<p class="CodeGroup">exit 0;</p>
<h4><a name="MiniTOCBookMark22" id="MiniTOCBookMark22"></a>Appendix B: audit-nagios.pl</h4>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">#!/usr/local/groundwork/perl/bin/perl</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">my $check_interval=60;</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">my $last_check_time=time;</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">while(1) {</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">&#160;&#160;# build a list of nagios.cfg files to stat</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">&#160;&#160;my @files=();</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">&#160;&#160;my @files=`find /usr/local/groundwork/nagios/etc -name nagios.cfg`;</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">&#160;&#160;foreach $file (@files) {</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">&#160;&#160;&#160;&#160;my $message='';</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">&#160;&#160;&#160;&#160;chomp $file;</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">&#160;&#160;&#160;&#160;my $result=`/usr/bin/stat -c %Y $file`;</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">&#160;&#160;&#160;&#160;chomp $result;</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">&#160;&#160;&#160;&#160;if ($result gt $last_check_time ) { # if file has changed</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">&#160;&#160;&#160;&#160;&#160;&#160;my $line = `/bin/grep "nagios.cfg generated" $file`;</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">&#160;&#160;&#160;&#160;&#160;&#160;chomp $line;</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">&#160;&#160;&#160;&#160;&#160;&#160;my ($date,$user) = $line=~/generated\s(\d\d\d\d-\d\d-\d\d\s\d\d:\d\d:\d\d)\sby\s(\S+)\sfrom/;</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">&#160;&#160;&#160;&#160;&#160;&#160;$message="File $file updated by user $user at $date.";</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">&#160;&#160;&#160;&#160;&#160;&#160;log_audit_message($file,$message);</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">&#160;&#160;&#160;&#160;}</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">&#160;&#160;}</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">&#160;&#160;$last_check_time=time;</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">&#160;&#160;sleep $check_interval;</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">}</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">exit 0;</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">sub log_audit_message {</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">&#160;&#160;my $file = shift;</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">&#160;&#160;my $message = shift;</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">&#160;&#160;my $result = `/usr/bin/logger -p local4.info $message`;</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">}</p>
<h4><a name="MiniTOCBookMark23" id="MiniTOCBookMark23"></a>Appendix C: run</h4>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">#!/bin/sh</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;"># Script for Supervise : Audit Nagios Feeder</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">exec /usr/local/groundwork/common/bin/setuidgid nagios /usr/local/groundwork/foundation/feeder/audit-nagios.pl</p>
<h4><a name="MiniTOCBookMark24" id="MiniTOCBookMark24"></a>Appendix D: syslog-ng.conf settings</h4>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">filter f_audit-nagios { message(); };</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">template t_gw_audit-nagios_feeder</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">{</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">&#160;&#160;template("&lt;GENERICLOG MonitorServerName='localhost' Device='$HOST' ApplicationType='AUDIT' MonitorStatus='WARNING' ReportDate='$YEAR-$MONTH-$DAY $HOUR:$MIN:$SEC' Severity='WARNING' ipaddress='$HOST' SubComponent='$PROGRAM' TextMessage='$MSGONLY' /&gt;\n");</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">};</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">destination d_gw_audit-nagios_feeder { tcp("localhost" port(4913) template(t_gw_audit-nagios_feeder)); };</p>
<p class="CodeGroup" style="font-weight: bold; margin-left: 24px; font-size: 9pt;">log { source(s_local); filter(f_audit-nagios); destination(d_gw_audit-nagios_feeder); };</p>
<h2><a name="MiniTOCBookMark25" id="MiniTOCBookMark25"></a>LDAP Authentication Configuration</h2>
<h3><a name="MiniTOCBookMark26" id="MiniTOCBookMark26"></a>How to integrate with Active Directory, OpenLDAP, and LDAPs</h3>
<h4><a name="MiniTOCBookMark27" id="MiniTOCBookMark27"></a>Introduction</h4>
<p><span style="font-style: italic;"><i>GroundWork Monitor</i></span> supports single sign-on authentication through an external authentication source. Authentication services can be provided by <span style="font-style: italic;"><i>Microsoft Active Directory</i></span>, or through a standards-compliant <span style="font-style: italic;"><i>LDAP</i></span> server. Most user accounts need not be defined in <span style="font-style: italic;"><i>GroundWork Monitor</i></span> a priori.</p>
<p>User accounts must still be assigned system-specific roles and privileges, and the use of <span style="font-style: italic;"><i>LDAP</i></span> for authentication changes the way this is done. Configuring the <span style="font-style: italic;"><i>GroundWork JBoss Portal</i></span> for <span style="font-style: italic;"><i>LDAP</i></span> allows user passwords and other details such as role membership to be managed by the external directory service. User accounts and roles are synchronized with the <span style="font-style: italic;"><i>GroundWork JBoss Portal</i></span> when the user logs in, and users are assigned a default role as well as any roles they are members of in <span style="font-style: italic;"><i>LDAP</i></span>.</p>
<p>This how-to goes through an example of setup, configuration, and assignment of users to roles in the context of users and groups that are managed by <span style="font-style: italic;"><i>LDAP</i></span>.</p>
<p>It is also possible to enable <span style="font-style: italic;"><i>LDAPS</i></span>, or <span style="font-style: italic;"><i>LDAP over SSL</i></span>, as well as many other alternate configurations. Please see the reference materials for <span style="font-style: italic;"><i>JBoss LDAP</i></span> configuration available here if you would like to study the various options and customize your <span style="font-style: italic;"><i>LDAP</i></span> setup with <span style="font-style: italic;"><i>GroundWork Monitor</i></span>.</p>
<p><span style="font-style: italic;"><i>GroundWork Monitor 6.4</i></span> introduces J<span style="font-style: italic;"><i>Boss Single Sign-on</i></span> (<span style="font-style: italic;"><i>JOSSO</i></span>), which entails additional security for applications managed by the portal, and thus requires a few additional steps for configuration when using <span style="font-style: italic;"><i>LDAP</i></span>.</p>
<h5><a name="MiniTOCBookMark28" id="MiniTOCBookMark28"></a>Important Points Before You Start</h5>
<ul style="font-size: 9pt;">
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1" style="font-size: 9pt;"><span style="font-style: italic;"><i>LDAP</i></span> users cannot be assigned to roles using the portal administrator application unless you do not use the <span style="font-style: italic;"><i>SynchronizeRoles</i></span> option</p>
</li>
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1" style="font-size: 9pt;"><span style="font-style: italic;"><i>LDAP</i></span> users do NOT need to be defined in the portal (this is different from <span style="font-style: italic;"><i>GroundWork Monitor 5.x</i></span>)</p>
</li>
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1" style="font-size: 9pt;">Configuration of <span style="font-style: italic;"><i>LDAP</i></span> parameters is done outside of the User Interface, and requires a restart of <span style="font-style: italic;"><i>gwservices</i></span></p>
</li>
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1" style="font-size: 9pt;">User passwords are never synchronized from <span style="font-style: italic;"><i>LDAP</i></span> to the <span style="font-style: italic;"><i>GroundWork</i></span> portal database</p>
</li>
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1" style="font-size: 9pt;">A default <span style="font-style: italic;"><i>webservices</i></span> user <span style="font-style: italic;"><i>wsuser</i></span> account is required, and is managed in the <span style="font-style: italic;"><i>GroundWork</i></span> portal database. You can rename this user if you wish, it is always managed in the portal, whether you use <span style="font-style: italic;"><i>LDAP</i></span> or not</p>
</li>
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1" style="font-size: 9pt;">Any active user account should belong to a group called <span style="font-style: italic;"><i>Authenticated</i></span> in <span style="font-style: italic;"><i>LDAP</i></span></p>
</li>
</ul>
<p><span style="font-style: italic;"><i>GroundWork Monitor</i></span> must be configured with the <span style="font-style: italic;"><i>LDAP</i></span> server name, a user name and password to bind to <span style="font-style: italic;"><i>LDAP</i></span> with, and the specific container or organizational unit containing the users to be allowed access.</p>
<p><span style="font-weight: bold; color: #ff0000;"><font color="red"><b>Note:</b></font></span> The bind user will need browse and search permissions for the locations in <span style="font-style: italic;"><i>LDAP</i></span> where the users and groups are stored.</p>
<p>These values must be input into an XML configuration file in a specific location, and the <span style="font-style: italic;"><i>GroundWork JBoss Portal</i></span> must be restarted for the configuration to take effect.</p>
<p>This process is best illustrated with an example. The following sections first outline requirements and options and then describes an example of configuring <span style="font-style: italic;"><i>GroundWork Monitor</i></span> for <span style="font-style: italic;"><i>Microsoft Active Directory</i></span> authentication. <span style="font-style: italic;"><i>LDAP</i></span> configuration is similar, and described in a subsequent example.</p>
<h5><a name="MiniTOCBookMark29" id="MiniTOCBookMark29"></a>Requirements and Options</h5>
<ul style="font-size: 9pt;">
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1" style="font-size: 9pt;">[Required] <span style="font-style: italic;"><i>Active Directory</i></span> domain controller to which you have administrative access</p>
</li>
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1" style="font-size: 9pt;">[Required] Account with rights to browse the container in which you store the users</p>
</li>
</ul>
<p class="PopText" style="margin-left: 40px; font-size: 9pt;">Example ldapauth, context:</p>
<p class="PopText" style="margin-left: 40px; font-size: 9pt; font-style: italic;">cn=ldapauth,ou=GWUsers,dc=demo,dc=com</p>
<ul style="font-size: 9pt;">
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1" style="font-size: 9pt;">[Optional] Roles in the portal for desired access levels</p>
</li>
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1" style="font-size: 9pt;">[Optional] A container and groups set up to match roles in the portal</p>
</li>
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1" style="font-size: 9pt;">[Useful]: adsiedit.msc utility</p>
</li>
</ul>
<h5><a name="MiniTOCBookMark30" id="MiniTOCBookMark30"></a>Web Service Security</h5>
<p>As mentioned above, web services are secured using a <span style="font-style: italic;"><i>webservices</i></span> proxy user <span style="font-style: italic;"><i>wsuser</i></span> by default. This user is managed in the portal user management. The user name and password used are stored in <span class="CodeInline">/usr/local/groundwork/config/ws_client.properties</span>. This user name should not exist in <span style="font-style: italic;"><i>LDAP</i></span>, or a conflict may result. If for some reason there is a <span style="font-style: italic;"><i>wsuers</i></span> in your <span style="font-style: italic;"><i>LDAP</i></span> that can't be removed, change this name in the <span style="font-style: italic;"><i>ws_client.properties</i></span> file.</p>
<p>You should restart <span style="font-style: italic;"><i>gwservices</i></span> if you modify this file.</p>
<h5><a name="MiniTOCBookMark31" id="MiniTOCBookMark31"></a>Portal Proxy User</h5>
<p>The portal proxy user is used to access API's of applications secured by the portal. You can either use an existing user or create a new one. If you do change from the default, you must add this user to the LDAP system you are using to synchronize from. Make sure that the user is member of the Authenticated role (group) in LDAP. The login ID and password in LDAP always has to match the entries for the proxy user settings in the <span style="font-style: italic;"><i>/usr/local/groundwork/config/foundation.properties</i></span> file:</p>
<p class="CodeGroup" style="font-size: 9pt;">\##############################################</p>
<p class="CodeGroup" style="font-size: 9pt;">\#portal proxy user name and password</p>
<p class="CodeGroup" style="font-size: 9pt;">portal.proxy.user=user</p>
<p class="CodeGroup" style="font-size: 9pt;">portal.proxy.password=password</p>
<p class="CodeGroup" style="font-size: 9pt;">\##############################################</p>
<p>You should restart <span style="font-style: italic;"><i>gwservices</i></span> if you modify this file.</p>
<h5><a name="MiniTOCBookMark32" id="MiniTOCBookMark32"></a>Portal Admin User</h5>
<p>Some operations in the portal can only be executed by the <span style="font-style: italic;"><i>admin</i></span> user, such as defining the default preferences for dashboard pages. By default the admin user is a member of the <span style="font-style: italic;"><i>GWAdmin</i></span> role defined in <span style="font-style: italic;"><i>GroundWork Monitor</i></span>. If you use <span style="font-style: italic;"><i>LDAP</i></span> for <span style="font-style: italic;"><i>GroundWork Monitor</i></span> authentication/authorization, the <span style="font-style: italic;"><i>admin</i></span> user name might be already in use in <span style="font-style: italic;"><i>LDAP</i></span>, thus creating a conflict, or you may not want to use this user name for reasons of user name standardization.</p>
<p>In this case, you can define a new user in <span style="font-style: italic;"><i>LDAP</i></span> (<span style="font-style: italic;"><i>gwadmin</i></span> for example) and make them a member of the <span style="font-style: italic;"><i>GWAdmin</i></span> and <span style="font-style: italic;"><i>Authenticated Roles</i></span> (groups in <span style="font-style: italic;"><i>LDAP</i></span>). You can then adjust the default <span style="font-style: italic;"><i>admin</i></span> user name to match in <span style="font-style: italic;"><i>GroundWork Monitor</i></span>. For example, let's say you want the <span style="font-style: italic;"><i>GroundWork Monitor Admin</i></span> user to be called <span style="font-style: italic;"><i>gwadmin</i></span> instead of <span style="font-style: italic;"><i>admin</i></span>:</p>
<p>Edit:<span class="CodeInline">/usr/local/groundwork/foundation/container/webapps/jboss/jboss-web.deployer/conf/web.xml</span></p>
<p>change:</p>
<p class="NormalIndentBullet1">&lt;context-param&gt;</p>
<p class="NormalIndentBullet1">&#160;&#160;&#160;&#160;&lt;param-name&gt;defaultDashboardAdminUser&lt;/param-name&gt;</p>
<p class="NormalIndentBullet1">&#160;&#160;&#160;&#160;&lt;param-value&gt;<span style="color: #ff0000; font-weight: bold;"><font color="red"><b>admin</b></font></span>&lt;/param-value&gt;</p>
<p class="NormalIndentBullet1">&#160;&#160;&#160;&#160;&lt;description&gt;The admin user is used to define the preferences that are inherited by dashboard portlets&lt;/description&gt;</p>
<p class="NormalIndentBullet1">&lt;/context-param&gt;</p>
<p>to:</p>
<p class="NormalIndentBullet1">&lt;context-param&gt;</p>
<p class="NormalIndentBullet1">&#160;&#160;&#160;&#160;&lt;param-name&gt;defaultDashboardAdminUser&lt;/param-name&gt;</p>
<p class="NormalIndentBullet1">&#160;&#160;&#160;&#160;&lt;param-value&gt;<span style="font-weight: bold; color: #ff0000;"><font color="red"><b>gwadmin</b></font></span>&lt;/param-value&gt;</p>
<p class="NormalIndentBullet1">&#160;&#160;&#160;&#160;&lt;description&gt;The admin user is used to define the preferences that are inherited by dashboard portlets&lt;/description&gt;</p>
<p class="NormalIndentBullet1">&lt;/context-param&gt;</p>
<p>You should restart <span style="font-style: italic;"><i>gwservices</i></span> if you modify this file.</p>
<h4><a name="MiniTOCBookMark33" id="MiniTOCBookMark33"></a>Recommended LDAP Setup</h4>
<p>Portal access authentication is controlled by <span style="font-style: italic;"><i>Role</i></span> permissions. Users gain access to different sections of the portal through role membership. In <span style="font-style: italic;"><i>LDAP</i></span>, group membership is used to map <span style="font-style: italic;"><i>Role</i></span> membership in <span style="font-style: italic;"><i>GroundWork Monitor</i></span>. So, in order to manage roles in <span style="font-style: italic;"><i>GroundWork Monitor</i></span>, you should setup a new context (an _organizational unit_ in AD by default) for the <span style="font-style: italic;"><i>GroundWork Monitor</i></span> roles.</p>
<p>Example: <span style="font-style: italic;"><i>GWRoles (OU=GWRoles)</i></span></p>
<p>To this monitoring specific context add the following <span style="font-style: italic;"><i>Groups</i></span>:</p>
<ul style="font-size: 9pt;">
<li class="P-Bullet1" style="font-style: italic; font-size: 9pt;">
<p class="Bullet1" style="font-size: 9pt;">GWAdmin</p>
</li>
<li class="P-Bullet1" style="font-style: italic; font-size: 9pt;">
<p class="Bullet1" style="font-size: 9pt;">GWOperator</p>
</li>
<li class="P-Bullet1" style="font-style: italic; font-size: 9pt;">
<p class="Bullet1" style="font-size: 9pt;">GWUser</p>
</li>
<li class="P-Bullet1" style="font-style: italic; font-size: 9pt;">
<p class="Bullet1" style="font-size: 9pt;">Authenticated</p>
</li>
</ul>
<p>You can then add company specific groups to the <span style="font-style: italic;"><i>GWRoles</i></span> context, which you can use to define specific access rights in <span style="font-style: italic;"><i>GroundWork Monitor</i></span>. When a user logs in, <span style="font-style: italic;"><i>Groups</i></span> in the <span style="font-style: italic;"><i>GWRoles</i></span> context of which the user is member of will by synchronized with <span style="font-style: italic;"><i>Roles</i></span> in the portal.</p>
<p>With this setup only <span style="font-style: italic;"><i>GroundWork Monitoring</i></span> specific roles will be synchronized even if the user is member of other groups in different contexts (containers). This avoids crowding the <span style="font-style: italic;"><i>GroundWork Monitor</i></span> administration pages with roles unrelated to monitoring.</p>
<p class="Figure"><img src="Assets/howtos_ldap.gif" alt="howtos_ldap.gif" style="border: none;" width="400" height="205" border="0" /></p>
<h4><a name="MiniTOCBookMark34" id="MiniTOCBookMark34"></a>Active Directory Example</h4>
<h5><a name="MiniTOCBookMark35" id="MiniTOCBookMark35"></a>Background</h5>
<p>By default, the <span style="font-style: italic;"><i>Active Directory</i></span> system places all users into a container defined by the system as:</p>
<p class="CodeGroup">cn=Users,dc=&lt;myorganization&gt;,dc=&lt;com&gt;</p>
<p>Where <span class="CodeInline">&lt;myorganization&gt;</span> is specific to the domain name of your implementation and <span class="CodeInline">&lt;com&gt;</span> is the typical default suffix. For instance, if the <span style="font-style: italic;"><i>Active Directory</i></span> domain is <span class="CodeInline">groundworkers.com</span>, the users would be stored in:</p>
<p class="CodeGroup">cn=Users,dc=groundworkers,dc=com</p>
<p>Through the <span style="font-style: italic;"><i>Active Directory</i></span> administration tool a sys admin can add <span style="font-style: italic;"><i>Organizational Units</i></span> (<span style="font-style: italic;"><i>OU</i></span>), which are functionally the same as <span style="font-style: italic;"><i>Containers</i></span> (<span style="font-style: italic;"><i>CN</i></span>) to organize <span style="font-style: italic;"><i>Roles</i></span>. The distinction between <span style="font-style: italic;"><i>Container</i></span> and <span style="font-style: italic;"><i>Organizational Unit</i></span> is important when configuring the portal for <span style="font-style: italic;"><i>LDAP</i></span>, since if you specify a <span style="font-style: italic;"><i>CN</i></span> in the file in <span style="font-style: italic;"><i>GroundWork Monitor</i></span>, but create an <span style="font-style: italic;"><i>OU</i></span> in <span style="font-style: italic;"><i>Active Directory</i></span>, it will not find the <span style="font-style: italic;"><i>Container</i></span> and login will fail to assign roles correctly. It's easy to see the difference:</p>
<p>The configuration entry for a <span style="font-style: italic;"><i>Container</i></span> uses the <span style="font-style: italic;"><i>CN</i></span> prefix. Example:</p>
<p style="margin-left: 40px;">rolesCtxDN="<span class="CodeInline">CN=GWRoles,dc=demo,dc=com</span>"</p>
<p>While for an <span style="font-style: italic;"><i>Organizational Unit</i></span> the prefix is <span style="font-style: italic;"><i>OU</i></span>. Example:</p>
<p style="margin-left: 40px;">rolesCtxDN="<span class="CodeInline">OU=GWRoles,dc=demo,dc=com</span>"</p>
<p>When you use the <span style="font-style: italic;"><i>Active Directory Users and Computers</i></span> tool and create new objects, the only container you can create is an <span style="font-style: italic;"><i>OU</i></span>, so the latter of the above formats is the one to use.</p>
<p>Setting the <span style="font-style: italic;"><i>SynchronizeRoles</i></span> option to <span style="font-style: italic;"><i>true</i></span> will set up this role in <span style="font-style: italic;"><i>GroundWork Monitor</i></span> automatically when the first <span style="font-style: italic;"><i>Active Directory</i></span> user logs in. This is the recommended configuration, as it will make management transparent. If you decide not to use <span style="font-style: italic;"><i>SynchronizeRoles</i></span>, you will need to create any roles you wish to have the users be members of in <span style="font-style: italic;"><i>GroundWork Monitor</i></span>, and manually match the names of these roles to the group names in <span style="font-style: italic;"><i>Active Directory</i></span>.</p>
<p>The default role all users are assigned to is <span style="font-style: italic;"><i>GWUser</i></span>, so you can create a group called <span style="font-style: italic;"><i>GWUser</i></span> in <span style="font-style: italic;"><i>Active Directory</i></span>, and place users to whom you wish to grant default access to <span style="font-style: italic;"><i>GroundWork Monitor</i></span> into this group.</p>
<p>Similarly, if you wish to designate operators or administrators from among the <span style="font-style: italic;"><i>Active Directory</i></span> users, you should create groups named <span style="font-style: italic;"><i>GWOperator</i></span> and <span style="font-style: italic;"><i>GWAdmin</i></span>, and add your users to these groups. It is recommended that you place these groups in an alternate organizational unit (see above for <span style="font-style: italic;"><i>Recommended LDAP Setup</i></span> section).</p>
<p><span style="font-weight: bold; color: #ff0000;"><font color="red"><b>Note:</b></font></span> In previous versions of <span style="font-style: italic;"><i>GroundWork Monitor</i></span>, the default role names were <span style="font-style: italic;"><i>Admin</i></span>, <span style="font-style: italic;"><i>Operator</i></span>, and <span style="font-style: italic;"><i>User</i></span>. These generic names often conflicted with default group names in <span style="font-style: italic;"><i>Active Directory</i></span>, and so they were changed as of <span style="font-style: italic;"><i>GroundWork Monitor 6.2</i></span>. If you are using a system upgraded from before 6.2 to 6.2 or later, you must change the group names in <span style="font-style: italic;"><i>Active Directory</i></span>, and add new roles to the <span style="font-style: italic;"><i>GroundWork Monitor</i></span> portal to match the <span style="font-style: italic;"><i>Group</i></span> names. The <span style="font-style: italic;"><i>GWAdmin</i></span> role (formerly <span style="font-style: italic;"><i>Admin</i></span>) is special, and you can't grant the same rights to another role. Please use the <span style="font-style: italic;"><i>GWAdmin</i></span> role for your administrative users. If you need to have this role name changed, please contact <span style="font-style: italic;"><i>GroundWork Support</i></span>.</p>
<p>This example assumes that you have created the organizational unit <span style="font-style: italic;"><i>GWUsers</i></span>, and that you have added your users to groups in this <span style="font-style: italic;"><i>OU</i></span>.</p>
<h5><a name="MiniTOCBookMark36" id="MiniTOCBookMark36"></a>Configuration Steps</h5>
<ol style="font-size: 9pt;">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Before changing the authentication method the portal should be stopped by issuing the command. <span style="color: #ff0000; font-weight: bold;"><font color="red"><b>Note:</b></font></span> All users will be logged out, so be sure to do this in a downtime window.</p>
</li>
</ol>
<p class="GroupCode2">service groundwork stop gwservices</p>
<ol start="2" style="font-size: 9pt;" type="1">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">To enable <span style="font-style: italic;"><i>Active Directory</i></span> authentication, log in to the command line as root or equivalent, and modify:</p>
</li>
</ol>
<p class="GroupCode2">/usr/local/groundwork/foundation/container/webapps/jboss/jboss-portal.sar/conf/login-config.xml</p>
<ol start="3" style="font-size: 9pt;" type="1">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Uncomment the section in <span style="font-style: italic;"><i>JOSSOLoginModule</i></span>:</p>
</li>
</ol>
<p style="margin-left: 40px;">Like this:</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">&lt;application-policy name="</font></span><span class="CodeInline">josso</span><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"&gt;</font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">&#160;&#160;authentication&gt;</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;login-module code="</font></span><span class="CodeInline">org.jboss.portal.identity.sso.josso.JOSSOLoginModule</span><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"</font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;flag="</font></span><span class="CodeInline">required</span><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"&gt;</font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;module-option name="</font></span><span class="CodeInline">debug</span><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"&gt;true&lt;/module-option&gt;</font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;!--</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Uncomment this section for LDAP/AD configuration. For more info refer documentation.</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;--&gt;</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;module-option name="</font></span><span class="CodeInline">synchronizeIdentity</span><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"&gt;true&lt;/module-option&gt;</font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;module-option name="</font></span><span class="CodeInline">synchronizeRoles</span><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"&gt;true&lt;/module-option&gt;</font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;module-option name="</font></span><span class="CodeInline">preserveRoles</span><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"&gt;true&lt;/module-option&gt;</font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;module-option name="</font></span><span class="CodeInline">additionalRole</span><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"&gt;Authenticated&lt;/module-option&gt;</font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;module-option name="</font></span><span class="CodeInline">defaultAssignedRole</span><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"&gt;GWUser&lt;/module-option&gt;</font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;module-option</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;name="</font></span><span class="CodeInline">userModuleJNDIName</span><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"&gt;java:/portal/UserModule&lt;/module-option&gt;</font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;module-option</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;name="</font></span><span class="CodeInline">roleModuleJNDIName</span><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"&gt;java:/portal/RoleModule&lt;/module-option&gt;</font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;module-option</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;name="</font></span><span class="CodeInline">membershipModuleJNDIName</span><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"&gt;java:/portal/MembershipModule&lt;/module-option&gt;</font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;module-option</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;name="</font></span><span class="CodeInline">userProfileModuleJNDIName</span><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"&gt;java:/portal/UserProfileModule&lt;/module-option&gt;</font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;/login-module&gt;</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">&#160;&#160;&lt;/authentication&gt;</p>
<ol start="4" style="font-size: 9pt;">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Save the file.</p>
</li>
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Edit <span class="CodeInline">/usr/local/groundwork/config/resources/josso-gateway-ldap-stores.xml</span> with your appropriate L<span style="font-style: italic;"><i>DAP/AD</i></span> properties. You will be replacing <span style="font-style: italic;"><i>server</i></span> with the resolvable hostname or IP address of your <span style="font-style: italic;"><i>LDAP</i></span> server, <span style="font-style: italic;"><i>Administrator</i></span> with the user name of your <span style="font-style: italic;"><i>LDAP</i></span> user (authorized to browse the containers where your users are), <span style="font-style: italic;"><i>password</i></span> with that users password, and the <span style="font-style: italic;"><i>cn=XXX</i></span> names with those appropriate for your <span style="font-style: italic;"><i>AD</i></span> system.</p>
</li>
</ol>
<p style="margin-left: 40px;">For example, if your domain is <span style="font-style: italic;"><i>demo.com</i></span>, following the recommendations above,</p>
<p style="margin-left: 40px;">You might set:</p>
<p style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">securityPrincipal="</font></span><span class="CodeInline">cn=ldapauth,cn=Users,dc=demo,dc=com</span><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"</font></span></p>
<p style="margin-left: 80px;">to use the <span style="font-style: italic;"><i>ldapauth</i></span> user in the <span style="font-style: italic;"><i>Users</i></span> container to be able to browse the <span style="font-style: italic;"><i>AD</i></span> tree.</p>
<p style="margin-left: 40px;">You might set:</p>
<p style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">usersCtxDN="</font></span><span class="CodeInline">CN=Users,dc=demo,dc=com</span><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"</font></span></p>
<p style="margin-left: 80px;">to be able to see all the users in the default location.</p>
<p style="margin-left: 40px;">You might set:</p>
<p style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">rolesCtxDN="</font></span><span class="CodeInline">OU=GWRoles,dc=demo,dc=com</span><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"</font></span></p>
<p style="margin-left: 40px;">if you set up that <span style="font-style: italic;"><i>OU</i></span>, and added the groups <span style="font-style: italic;"><i>GWAdmin</i></span>, <span style="font-style: italic;"><i>GWOperator</i></span>, <span style="font-style: italic;"><i>GWUser</i></span>, and <span style="font-style: italic;"><i>Authenticated</i></span> there, as recommended. <span style="color: #ff0000; font-weight: bold;"><font color="red"><b>Note:</b></font></span> The <span style="font-style: italic;"><i>rolesCtxDN</i></span> is an <span style="font-style: italic;"><i>OU</i></span>, not a <span style="font-style: italic;"><i>CN</i></span> in <span style="font-style: italic;"><i>Active Directory</i></span>.</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">&lt;ldap-istore:ldap-bind-store</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">id="</font></span>josso-identity-store<span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"</font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">initialContextFactory="</font></span>com.sun.jndi.ldap.LdapCtxFactory<span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"</font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">providerUrl="ldap://<span style="color: #ff0000; font-weight: bold;"><font color="red"><b>server</b></font></span>:389"</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">securityPrincipal="cn=<span style="color: #ff0000; font-weight: bold;"><font color="red"><b>Administrator</b></font></span>,cn=Users,dc=demo,dc=com"</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">securityCredential="<span style="color: #ff0000; font-weight: bold;"><font color="red"><b>password</b></font></span>"</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">securityAuthentication="</font></span>simple<span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"</font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">ldapSearchScope="</font></span>SUBTREE<span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"</font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">usersCtxDN="<span style="color: #ff0000; font-weight: bold;"><font color="red"><b>CN=Users,dc=demo,dc=com</b></font></span>"</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">principalUidAttributeID="</font></span>sAMAccountName<span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"</font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">uidAttributeID="</font></span>member<span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"</font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">rolesCtxDN="<span style="color: #ff0000; font-weight: bold;"><font color="red"><b>OU=GWRoles,dc=demo,dc=com</b></font></span>"</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">roleAttributeID="</font></span>sAMAccountName<span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"</font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">credentialQueryString="</font></span>uid=sAMAccountName<span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"</font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">userPropertiesQueryString="</font></span>mail=mail,cn=description<span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"</font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">/&gt;</p>
<ol start="6" style="font-size: 9pt;">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Save the file.</p>
</li>
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Edit: <span class="CodeInline">/usr/local/groundwork/config/resources/josso-gateway-config.xml</span></p>
</li>
</ol>
<p class="NormalIndentBullet1">Replace the following line:</p>
<p class="GroupCode2">&lt;s:import resource="josso-gateway-db-stores.xml" /&gt;</p>
<p class="NormalIndentBullet1">with</p>
<p class="GroupCode2">&lt;s:import resource="josso-gateway-ldap-stores.xml" /&gt;</p>
<p class="NormalIndentBullet1">Like this:</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">&#160;&lt;!-- Identity, Session and Assertion Stores configuration --&gt;</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;!-- &lt;s:import resource="</font></span><span class="CodeInline">josso-gateway-db-stores.xml</span><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">" /&gt; &#160;--&gt;</font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;s:import resource="</font></span><span class="CodeInline">josso-gateway-ldap-stores.xml</span><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">" /&gt;</font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 40px;">Search for <span style="font-style: italic;"><i>josso-basic-authentication</i></span> and replace it with <span style="font-style: italic;"><i>josso-bind-authentication</i></span>:</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">Like this:</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">&#160;&lt;def-auth:authenticator id="</font></span><span class="CodeInline">josso-authenticator</span><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"&gt;</font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">&#160;&#160;&#160;&#160;&#160;&lt;def-auth:schemes&gt;</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;!-- &#160;&#160;&#160;&lt;s:ref bean="</font></span><span class="CodeInline">josso-basic-authentication</span><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"/&gt; --&gt;</font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;s:ref bean="</font></span><span class="CodeInline">josso-bind-authentication</span><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"/&gt;</font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">&#160;&#160;&#160;&#160;&#160;&lt;/def-auth:schemes&gt;</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">&#160;&lt;/def-auth:authenticator&gt;</p>
<ol start="8" style="font-size: 9pt;" type="1">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Save the file.</p>
</li>
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Edit: <span class="CodeInline">/usr/local/groundwork/config/resources/josso-gateway-auth.xml</span></p>
</li>
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Uncomment <span style="font-style: italic;"><i>BIND Authentication Scheme (normally LDAP)</i></span> section.</p>
</li>
</ol>
<p style="margin-left: 40px;">Like this:</p>
<p class="PopText" style="font-size: 9pt; margin-left: 80px;">&#160;&#160;&lt;!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ --&gt;</p>
<p class="PopText" style="font-size: 9pt; margin-left: 80px;">&#160;&#160;&#160;&#160;&#160;&#160;&lt;!-- BIND Authentication Scheme (normally LDAP) --&gt;</p>
<p class="PopText" style="font-size: 9pt; margin-left: 80px;">&#160;&#160;&#160;&#160;&#160;&#160;&lt;!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ --&gt;</p>
<p class="PopText" style="font-size: 9pt; margin-left: 80px;">&#160;&#160;&#160;&#160;&#160;&#160;&lt;!-- Requires a be a bindalble credential store ! --&gt;</p>
<p class="PopText" style="font-size: 9pt; margin-left: 80px;">&#160;&#160;&#160;&#160;&#160;&#160;&lt;!-- name attribute is important and must not be changed --&gt;</p>
<p class="PopText" style="font-size: 9pt; margin-left: 80px;">&#160;&#160;&#160;&#160;&#160;&#160;&lt;bind-authscheme:bind-auth-scheme</p>
<p class="PopText" style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;id="</font></span><span class="CodeInline">josso-bind-authentication</span><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"</font></span></p>
<p class="PopText" style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;name="</font></span><span class="CodeInline">basic-authentication</span><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"</font></span></p>
<p class="PopText" style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;hashAlgorithm="</font></span><span class="CodeInline">MD5</span><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"</font></span></p>
<p class="PopText" style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;hashEncoding="</font></span><span class="CodeInline">HEX</span><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"</font></span></p>
<p class="PopText" style="font-size: 9pt; margin-left: 80px;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ignorePasswordCase="false"</p>
<p class="PopText" style="font-size: 9pt; margin-left: 80px;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ignoreUserCase="false"&gt;</p>
<p class="PopText" style="font-size: 9pt; margin-left: 80px;">&#160;</p>
<p class="PopText" style="font-size: 9pt; margin-left: 80px;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;bind-authscheme:credentialStore&gt;</p>
<p class="PopText" style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;s:ref bean="</font></span><span class="CodeInline">josso-identity-store</span><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"/&gt;</font></span></p>
<p class="PopText" style="font-size: 9pt; margin-left: 80px;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;/bind-authscheme:credentialStore&gt;</p>
<p class="PopText" style="font-size: 9pt; margin-left: 80px;">&#160;&#160;</p>
<p class="PopText" style="font-size: 9pt; margin-left: 80px;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;bind-authscheme:credentialStoreKeyAdapter&gt;</p>
<p class="PopText" style="margin-left: 80px;"><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;s:ref bean="</font></span><span class="CodeInline">josso-simple-key-adapter</span><span style="font-size: 9pt;"><font size="1" style="font-size:9pt;">"/&gt;</font></span></p>
<p class="PopText" style="font-size: 9pt; margin-left: 80px;">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;/bind-authscheme:credentialStoreKeyAdapter&gt;</p>
<p class="PopText" style="font-size: 9pt; margin-left: 80px;">&#160;&#160;</p>
<p class="PopText" style="font-size: 9pt; margin-left: 80px;">&#160;&#160;&#160;&#160;&#160;&#160;&lt;/bind-authscheme:bind-auth-scheme&gt;</p>
<ol start="11" style="font-size: 9pt;">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Save the file.</p>
</li>
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Now, start the <span style="font-style: italic;"><i>GroundWork</i></span> portal.</p>
</li>
</ol>
<p class="PopText" style="margin-left: 40px; font-size: 9pt;">Run as <span style="font-style: italic;"><i>root</i></span></p>
<p class="PopText" style="margin-left: 40px; font-size: 8pt;"><span class="CodeInline">service groundwork start gwservices</span></p>
<p>At this point, all the users in the Authenticated group in the <span style="font-style: italic;"><i>GWRoles OU</i></span> should be able to log in. If they are not members of a group named the same as a role in the portal, they will be mapped to the default <span style="font-style: italic;"><i>GWUser</i></span> role. This allows them essentially view-only access to the portal screens, including the status viewer. The groups they are members of in the <span style="font-style: italic;"><i>GWRoles OU</i></span> will be created as roles in the portal if they do not already exist, and you may proceed to grant access to pages for these roles in the usual way.</p>
<p>If they are members of the <span style="font-style: italic;"><i>GWOperator</i></span> group, they will have access to <span style="font-style: italic;"><i>Event Console</i></span> and <span style="font-style: italic;"><i>Nagios</i></span> screens, as well as the <span style="font-style: italic;"><i>Actions</i></span> menus in the <span style="font-style: italic;"><i>Status</i></span> screen.</p>
<p>If they are members of the <span style="font-style: italic;"><i>GWAdmin</i></span> group, they will have administrative access to the <span style="font-style: italic;"><i>GroundWork</i></span> portal. Note that only the <span style="font-style: italic;"><i>Portal Admin</i></span> user will be able to set up shared dashboards with portlet preferences that are inherited by other users.</p>
<h4><a name="MiniTOCBookMark37" id="MiniTOCBookMark37"></a>Integration with OpenLDAP</h4>
<h5><a name="MiniTOCBookMark38" id="MiniTOCBookMark38"></a>Important Points Before you Start</h5>
<ul style="font-size: 9pt;">
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1" style="font-size: 9pt;"><span style="font-style: italic;"><i>OpenLDAP</i></span> is hard to configure</p>
</li>
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1" style="font-size: 9pt;"><span style="font-style: italic;"><i>OpenLDAP</i></span> allows anonymous browsing by default. This can be a bad thing. always configure <span style="font-style: italic;"><i>GroundWork Monitor</i></span> to use a user to access containers</p>
</li>
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1" style="font-size: 9pt;">The user must have access to browse the tree in the <span style="font-style: italic;"><i>User</i></span> and <span style="font-style: italic;"><i>Role</i></span> context containers</p>
</li>
</ul>
<h5><a name="MiniTOCBookMark39" id="MiniTOCBookMark39"></a>Requirements and Options</h5>
<ul style="font-size: 9pt;">
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1" style="font-size: 9pt;">[Required] An OpenLDAP server</p>
</li>
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1" style="font-size: 9pt;">[Required] Administrative access to OpenLDAP (for setting up Users and Roles)</p>
</li>
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1" style="font-size: 9pt;">[Required] A user account with rights to scan the containers for Users and Roles</p>
</li>
</ul>
<ul style="font-size: 9pt;">
<li class="P-Bullet1" style="font-size: 9pt;">
<p class="Bullet1" style="font-size: 9pt;">[Useful]: LDAP browser</p>
</li>
</ul>
<h4><a name="MiniTOCBookMark40" id="MiniTOCBookMark40"></a>OpenLDAP Example</h4>
<h5><a name="MiniTOCBookMark41" id="MiniTOCBookMark41"></a>Background</h5>
<p><span style="font-style: italic;"><i>OpenLDAP</i></span> configuration is similar to <span style="font-style: italic;"><i>Active Directory</i></span> configuration. The requirements are similar as well. The main difference is in the configuration of <span style="font-style: italic;"><i>LDAP</i></span> itself, and the creation of a container for roles objects, whereas in <span style="font-style: italic;"><i>Active Directory</i></span> access to portal roles is controlled by group membership.</p>
<p><span style="font-style: italic;"><i>OpenLDAP</i></span> can be configured (as can <span style="font-style: italic;"><i>Active Directory</i></span>) to allow anonymous access for queries. This is not recommended, but it is supported.</p>
<p>This example assumes that you have set up your <span style="font-style: italic;"><i>openLDAP</i></span> server with a role container called <span style="font-style: italic;"><i>GWRoles</i></span>.</p>
<h5><a name="MiniTOCBookMark42" id="MiniTOCBookMark42"></a>Configuration Steps</h5>
<ol>
<li class="P-Numbering">
<p class="Numbering">To get started login to the <span style="font-style: italic;"><i>OpenLDAP</i></span> server and set up the <span style="font-style: italic;"><i>Users</i></span> container (default is <span style="font-style: italic;"><i>ou=People</i></span>), then set up the <span style="font-style: italic;"><i>Roles</i></span> container, add users to the <span style="font-style: italic;"><i>Users</i></span> container, <span style="font-style: italic;"><i>Roles</i></span> to the roles container, and add users to roles. It is a good idea to test your <span style="font-style: italic;"><i>LDAP</i></span> user login for browsing. <span style="color: #ff0000; font-weight: bold;"><font color="red"><b>Note:</b></font></span> <span style="font-style: italic;"><i>root</i></span> user is <span style="font-style: italic;"><i>cn=manager</i></span> by default, and while the <span style="font-style: italic;"><i>uid=root</i></span> object is in the <span style="font-style: italic;"><i>People</i></span> container the default context may be different, for example: <span style="font-style: italic;"><i>cn=manager,dc=groundworkers,dc=com</i></span></p>
</li>
</ol>
<ol start="2">
<li class="P-Numbering">
<p class="Numbering">Be sure to read the <span style="font-style: italic;"><i>Active Directory</i></span> section above.</p>
</li>
<li class="P-Numbering">
<p class="Numbering">To enable <span style="font-style: italic;"><i>OpenLDAP</i></span> authentication, log in to the <span style="font-style: italic;"><i>GroundWork</i></span> command line as <span style="font-style: italic;"><i>root</i></span> or equivalent, and modify the files as you would for the <span style="font-style: italic;"><i>Active Directory</i></span> example above.</p>
</li>
<li class="P-Numbering">
<p class="Numbering">When you edit <span class="CodeInline">/usr/local/groundwork/config/resources/josso-gateway-ldap-stores.xml</span>, be sure to use your appropriate <span style="font-style: italic;"><i>LDAP</i></span> properties:</p>
</li>
</ol>
<p style="margin-left: 40px;">For example:</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">&lt;ldap-istore:ldap-bind-store</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">id="<span class="CodeInline">josso-identity-store</span>"</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">initialContextFactory="<span class="CodeInline">com.sun.jndi.ldap.LdapCtxFactory</span>"</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">providerUrl="<span class="CodeInline">ldap</span>://server:389"</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">securityPrincipal="<span class="CodeInline">cn=Administrator,cn=Users,dc=demo,dc=com</span>"</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">securityCredential="<span class="CodeInline">password</span>"</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">securityAuthentication="<span class="CodeInline">simple</span>"</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">ldapSearchScope="<span class="CodeInline">SUBTREE</span>"</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">usersCtxDN="<span class="CodeInline">ou=GWUsers,dc=mycompany</span>"</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">principalUidAttributeID="<span class="CodeInline">uid</span>"</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">uidAttributeID="<span class="CodeInline">memberUid</span>"</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">rolesCtxDN="<span class="CodeInline">ou=GWRoles,dc=cmycompany</span>"</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">roleAttributeID="<span class="CodeInline">cn</span>"</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">credentialQueryString="<span class="CodeInline">uid=cn</span>"</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">userPropertiesQueryString="mail=mail,cn=description</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">/&gt;</p>
<ol start="5" type="1">
<li start="5" class="P-Numbering">
<p class="Numbering">Follow steps 7 thru 10 from the Active Directory section. You will need to save the file, and restart the portal. All users will be logged out, so be sure to do this in a downtime window.</p>
</li>
</ol>
<p style="margin-left: 40px;">Run as <span style="font-style: italic;"><i>root:</i></span> <span class="CodeInline">service groundwork restart gwservices</span></p>
<ol start="6" type="1">
<li class="P-Numbering">
<p class="Numbering">All other steps are the essentially the same as for <span style="font-style: italic;"><i>Active Directory</i></span>.</p>
</li>
</ol>
<h2><a name="MiniTOCBookMark43" id="MiniTOCBookMark43"></a>PostgreSQL</h2>
<h3><a name="MiniTOCBookMark44" id="MiniTOCBookMark44"></a>How to reset my PostgreSQL root user password</h3>
<p><font color="#FF0000"><b style="font-weight: bold;">Note:</b></font> This process will disrupt access to your system.</p>
<ol style="font-size: 9pt;">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Stop gwservices: <b><span class="CodeInline">/usr/local/groundwork/ctlscript.sh stop gwservices</span></b></p>
</li>
</ol>
<ol start="2" style="font-size: 9pt;" type="1">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Stop httpd: <b><span class="CodeInline">/usr/local/groundwork/ctlscript.sh stop apache</span></b></p>
</li>
</ol>
<ol start="3" type="1">
<li class="P-Numbering">
<p class="Numbering">Update your <span class="CodeInline">/usr/local/groundwork/postgresql/data/pg_hba.conf</span> to <span class="CodeInline">trust</span> for local connections</p>
</li>
</ol>
<p class="GroupCode2"><tt style="font-family: monospace;"><span class="Code">host&#160;&#160;&#160;&#160;all&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;all&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;127.0.0.1/32&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;trust&#160;</span></tt></p>
<p style="margin-left: 40px;">Open a psql session as the postgres user (you won't be asked for the password under TRUST authentication) to the database:</p>
<p class="GroupCode2"><tt style="font-family: monospace;">&gt;psql -U postgres</tt></p>
<p style="margin-left: 40px;">Execute the command:</p>
<p class="GroupCode2">postgres=# ALTER USER postgres WITH PASSWORD '&lt;newpassword&gt;';</p>
<p style="margin-left: 40px;">Leave the session:</p>
<p class="GroupCode2">postgres=# \q</p>
<p style="margin-left: 40px;">Undo the settings to trust in the <span class="CodeInline">/usr/local/groundwork/postgresql/data/pg_hba.conf</span> file:</p>
<p class="GroupCode2"><tt style="font-family: monospace;">host&#160;&#160;&#160;&#160;all&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;all&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;127.0.0.1/32&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;md5</tt></p>
<ol start="4" type="1">
<li class="P-Numbering">
<p class="Numbering">Restart gwservices: <b><span class="CodeInline">/usr/local/groundwork/ctlscript.sh restart gwservices</span></b></p>
</li>
</ol>
<ol start="5" type="1">
<li class="P-Numbering">
<p class="Numbering">Restart httpd: <b><span class="CodeInline">/usr/local/groundwork/ctlscript.sh restart apache</span></b></p>
</li>
</ol>
<ol start="6" type="1">
<li class="P-Numbering">
<p class="Numbering">You should now be able to connect using the new password.</p>
</li>
</ol>
<h3><a name="MiniTOCBookMark45" id="MiniTOCBookMark45"></a>How to restore a backup of the monarch database</h3>
<ol style="font-size: 9pt;">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Make sure no one is logged into the system:</p>
</li>
</ol>
<p style="margin-left: 40px;">Stop gwservices: <span class="CodeInline"><font><b style="font-weight: bold; font-size: 9pt;">/usr/local/groundwork/ctlscript.sh stop gwservices</b></font></span></p>
<p style="margin-left: 40px;">Stop the Nagios deamon: <span class="CodeInline"><font style="font-size: 9pt;" size="2">/usr/local/groundwork/ctlscript.sh stop nagios</font></span></p>
<p style="margin-left: 40px;">Stop httpd: <span class="CodeInline"><font><b style="font-weight: bold; font-size: 9pt;">/usr/local/groundwork/ctlscript.sh stop apache</b></font></span></p>
<p style="margin-left: 40px;">Delete the temporary session files:</p>
<p style="margin-left: 40px; font-weight: bold; font-size: 9pt;"><span class="CodeInline"><font size="1" style="font-size:9pt;"><b><font><b style="font-weight: bold; font-size: 9pt;">rm -rf /tmp/sess*</b></font></b></font></span></p>
<p style="margin-left: 40px; font-weight: bold; font-size: 9pt;"><span class="CodeInline"><font size="1" style="font-size:9pt;"><b><font><b style="font-weight: bold; font-size: 9pt;">rm -rf /tmp/tpl*</b></font></b></font></span></p>
<ol start="2" style="font-size: 9pt;">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Open a terminal session and login as: <span class="CodeInline"><font><b style="font-size: 9pt;">root</b></font></span></p>
</li>
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Change the directory to: <b><span class="CodeInline">cd /usr/local/groundwork/core/monarch/backup</span></b></p>
</li>
</ol>
<ol start="4" style="font-size: 9pt;" type="1">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">You should see a file with the name: <font color="#009B00"><b><span class="CodeInline">monarch_backup_&lt;timestamp&gt;.sql</span></b></font></p>
</li>
</ol>
<ol start="5" type="1">
<li class="P-Numbering">
<p class="Numbering">Restore the old database by entering the following command at the system prompt:</p>
</li>
</ol>
<p class="GroupCode2"><b style="font-weight: bold;"><font style="font-size: x-small;" size="2"><span style="font-weight: normal;">pg_restore</span></font> <font style="font-size: x-small;" size="2"><span style="font-weight: normal;">-d</span></font> </b><b>monarch</b> <b><font style="font-size: x-small;" size="2"><span style="font-weight: normal;">F</span></font> <font style="font-size: x-small;" size="2"><span style="font-weight: normal;">t</span></font> <font style="font-size: x-small;" size="2"><span style="font-weight: normal;">-c</span></font></b> <b>monarch_backup_&lt;</b><span class="CodeInline" style="line-height: 0.19in;"><font style="font-size: 9pt;" size="2"><i><b>timestamp</b></i></font></span><b>&gt;.sql.tar</b></p>
<ol start="6" type="1">
<li class="P-Numbering">
<p class="Numbering">Restart <span style="font-style: italic;"><i>gwservices</i></span>: <font color="#009B00"><b><span class="CodeInline">/usr/local/groundwork/ctlscript.sh start gwservices</span></b></font></p>
</li>
</ol>
<ol start="7" type="1">
<li class="P-Numbering">
<p class="Numbering">Restart httpd: <font color="#009B00"><b><span class="CodeInline">/usr/local/groundwork/ctlscript.sh start apache</span></b></font></p>
</li>
</ol>
<ol start="8" type="1">
<li class="P-Numbering">
<p class="Numbering">Restart <span style="font-style: italic;"><i>Nagios</i></span>: <font color="#009B00"><b><span class="CodeInline">/usr/local/groundwork/ctlscript.sh start nagios</span></b></font></p>
</li>
</ol>
<ol start="9" style="font-size: 9pt;">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">After relaunching your browser, you should clear your browser's cache.</p>
</li>
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Next, to view and confirm the restored configuration use the web interface to commit the restored monarch database by selecting the <span style="font-weight: bold;"><b>Configuration</b></span> application tab, and the options <span style="font-style: italic;"><i>Control</i></span>, <span style="font-style: italic;"><i>Pre flight test</i></span>, <span style="font-style: italic;"><i>Commit</i></span>, <span style="font-style: italic;"><i>Backup</i></span>, and then <span style="font-style: italic;"><i>Commit</i></span>.</p>
</li>
</ol>
<h2><a name="MiniTOCBookMark46" id="MiniTOCBookMark46"></a>Network Service</h2>
<h3><a name="MiniTOCBookMark47" id="MiniTOCBookMark47"></a>How to configure a proxy server</h3>
<p>The network service will not be able to receive updates if a non-transparent proxy is used. To configure the proxy settings complete the following steps:</p>
<ol style="font-size: 9pt;">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">First install the product and enable the network service during installation.</p>
</li>
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Login using a secure shell on the <span style="font-style: italic;"><i>GroundWork</i></span> server; <span class="CodeInline">cd /usr/local/groundwork/network-service/scripts/</span> or from the command line: <span class="CodeInline">./network-service-ctl.sh stop</span></p>
</li>
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Next; <span class="CodeInline">cd /usr/local/groundwork/network-service/bin/</span></p>
</li>
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">And edit the file <span class="CodeInline">agent.conf</span> adding the following;</p>
</li>
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">proxy_host=xxx.yyy.zzz.www</p>
</li>
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">proxy_port=pppp</p>
</li>
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Save your changes.</p>
</li>
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Now restart the network service; <span class="CodeInline">./network-service-ctl.sh start</span></p>
</li>
</ol>
<h2><a name="MiniTOCBookMark48" id="MiniTOCBookMark48"></a>Performance Graphs</h2>
<h3><a name="MiniTOCBookMark49" id="MiniTOCBookMark49"></a>How to troubleshoot performance graphs</h3>
<ol style="font-size: 9pt;">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Are the following configuration parameters properly configured in the <font color="#009B00"><b>nagios.cfg</b></font> file?</p>
</li>
</ol>
<p class="NormalIndentBullet1" style="margin-left: 60px;">perfdata_timeout = <span class="CodeInline"><font><b style="font-size: 9pt;">60</b></font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 60px;">process_performance_data = <span class="CodeInline"><font><b style="font-size: 9pt;">1</b></font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 60px;">service_perdata_command = <span class="CodeInline"><font><b style="font-size: 9pt;">process_service_perfdata_file</b></font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 60px;">service_perfdata_file = <span class="CodeInline"><font><b style="font-size: 9pt;">/usr/local/groundwork/nagios/eventhandlers/service_perfdata.log</b></font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 60px;">service_perfdata_file_template = <span class="CodeInline"><font><b style="font-size: 9pt;">$LASTSERVICECHECK$\t$HOSTNAME$\tSERVICEDESC$\t$SERVICEOUTPUT$\t$SERVICEPERFDATA$</b></font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 60px;">service_perfdata_file_mode = <span class="CodeInline"><font style="font-size: 9pt;" size="2">w</font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 60px;">service_perfdata_file_processing_interval = <span class="CodeInline"><font style="font-size: 9pt;" size="2">300</font></span></p>
<p class="NormalIndentBullet1" style="margin-left: 60px;">service_perfdata_file_processing_command = <span class="CodeInline"><font><b style="font-size: 9pt;">process_service_perfdata_file</b></font></span></p>
<ol start="2" style="font-size: 9pt;">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Is the file <span class="CodeInline"><font><b style="font-size: 9pt;">service_perfdata.log</b></font></span> in the <span class="CodeInline"><font><b style="font-size: 9pt;">/usr/local/groundwork/nagios/eventhandlers</b></font></span> directory? And does it have a current date and time stamp, within the past 10 minutes?</p>
</li>
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Is the file <span class="CodeInline"><font><b style="font-size: 9pt;">process_service_perf_db_file.pl</b></font></span> in the <span class="CodeInline"><font><b style="font-size: 9pt;">/usr/local/groundwork/nagios/eventhandlers</b></font></span> directory? And does it have the correct ownership and permissions?</p>
</li>
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Do the RRD files in the <span class="CodeInline"><font><b style="font-size: 9pt;">/usr/local/groundwork/rrd</b></font></span> directory have fairly current data and time stamps?</p>
</li>
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Is there an entry in <span style="font-weight: bold;"><b>Configuration&gt;Performance</b></span> application where the <span style="font-style: italic;"><i>Service</i></span> field matches the name of the Service you are trying to graph?</p>
</li>
</ol>
<h3><a name="MiniTOCBookMark50" id="MiniTOCBookMark50"></a>How to enable performance eventhandler logging</h3>
<ol style="font-size: 9pt;">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Edit the file:</p>
</li>
</ol>
<p class="GroupCode2"><b style="font-weight: bold;"><span class="CodeInline">/usr/local/groundwork/nagios/eventhandlers/process_service_perf_db_file</span></b></p>
<ol start="2" style="font-size: 9pt;" type="1">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Change this line:</p>
</li>
</ol>
<p class="GroupCode2"><b style="font-weight: bold;"><span class="CodeInline">my $debug = 0</span></b></p>
<p style="margin-left: 40px;">To this: <font color="#FF0000"><b>Note:</b></font> Don't forget to set this back to "<span class="CodeInline">0</span>" when you finish troubleshooting.</p>
<p class="GroupCode2"><b style="font-weight: bold;"><span class="CodeInline">my $debug = 3</span></b></p>
<ol start="4" style="font-size: 9pt;" type="1">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">After 5 minutes or so this should create the file:</p>
</li>
</ol>
<p class="GroupCode2"><b style="font-weight: bold;"><span class="CodeInline">/usr/local/groundwork/nagios/eventhandlers/process_service_perf.log</span></b></p>
<ol start="5" style="font-size: 9pt;" type="1">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Next, search through this log file for the name of the service you are troubleshooting.</p>
</li>
</ol>
<h3><a name="MiniTOCBookMark51" id="MiniTOCBookMark51"></a>How to remove hosts from the performance screen</h3>
<p>Following is a simple procedure to remove hosts from the performance screen.</p>
<ol style="font-size: 9pt;">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">From the command line set the environment to include the path to the tools:</p>
</li>
</ol>
<p class="GroupCode2">#source/usr/local/groundwork/scripts/setenv.sh</p>
<ol start="2" type="1">
<li class="P-Numbering">
<p class="Numbering">Log in to the postgres database:</p>
</li>
</ol>
<p class="GroupCode2"># psql -U postgres</p>
<ol start="3" type="1">
<li class="P-Numbering">
<p class="Numbering">Select the configuration database:</p>
</li>
</ol>
<p class="GroupCode2"><span class="CodeInline">postgres=# \c mon<font style="font-size: 9pt;" size="2">arch</font></span></p>
<ol start="4" type="1">
<li class="P-Numbering">
<p class="Numbering">Remove the entries you don't want from the <span class="CodeInline">host_service</span> table. For example:</p>
</li>
</ol>
<p style="margin-left: 40px;">To delete all entries for host "foo":</p>
<p class="GroupCode2"><b><span class="CodeInline">postgres=#</span> delete from host_service where host like 'foo'</b></p>
<p style="margin-left: 40px;">To delete all entries for service "foo_service"</p>
<p class="GroupCode2"><b><span class="CodeInline">postgres=#</span> delete from host_service where service like 'foo_service'</b></p>
<p style="margin-left: 40px;">To delete a specific service from a host and leave the others:</p>
<p class="GroupCode2">postgres=# <b>delete from host_service where host like 'foo' and service like 'foo_service'</b></p>
<h2><a name="MiniTOCBookMark52" id="MiniTOCBookMark52"></a>Reports</h2>
<h3><a name="MiniTOCBookMark53" id="MiniTOCBookMark53"></a>How to see data for Availability Reports after installation</h3>
<p>Immediately following a <span style="font-style: italic;"><i>GroundWork Monitor</i></span> installation there will not be any data displayed for Availability Reports. The data for these reports are generated by the <span class="CodeInline"><font><b style="font-size: 9pt;">dashboard_data_load.pl</b></font></span> and <span class="CodeInline"><font><b style="font-size: 9pt;">dashboard_avail_load.pl</b></font></span> scripts which normally run once a day, at night, as a cron job.</p>
<p>This is the expected behavior. These scripts can be executed manually to generate data earlier if required. The two scripts are located in directory:</p>
<p class="CodeGroup"><b style="font-weight: bold;"><span class="CodeInline">/usr/local/groundwork/core/reports/utils</span></b></p>
<p>The cronjob is in the crontab for the user <span class="CodeInline"><font><b style="font-size: 9pt;">nagios</b></font></span>. It can be viewed by typing the following command:</p>
<p class="CodeGroup"><b style="font-weight: bold;"><span class="CodeInline">crontab -l -u nagios</span></b></p>
<p>It should show the following:</p>
<p class="CodeGroup"><b style="font-weight: bold;"><span class="CodeInline">50 23 * * * /usr/local/groundwork/core/reports/utils/dashboard_data_load.pl &gt; /usr/local/groundwork/core/reports/utils/log/dashboard_data_load.log 2&gt;&amp;1 0 1 * * * /usr/local/groundwork/core/reports/utils/dashboard_avail_load.pl &gt; /usr/local/groundwork/core/reports/utils/log/dashboard_avail_load.log 2&gt;&amp;1</span></b></p>
<h2><a name="MiniTOCBookMark54" id="MiniTOCBookMark54"></a>Status Connection Protocols</h2>
<h3><a name="MiniTOCBookMark55" id="MiniTOCBookMark55"></a>How to define URLs for the Actions portlet Connections menu</h3>
<p>The default template for defining the URL's that are used for the Connection menu in the <span style="font-style: italic;"><i>Status</i></span> application Actions portlet of the Host and Services view are defined in the file:</p>
<p class="CodeGroup">/usr/local/groundwork/config/status-viewer.properties</p>
<p>The default URLs are as follows:</p>
<ul>
<li class="P-Bullet1">
<p class="Bullet1">portal.statusviewer.action.url.ssh=ssh://$HOST</p>
</li>
<li class="P-Bullet1">
<p class="Bullet1">portal.statusviewer.action.url.http=http://$HOST</p>
</li>
<li class="P-Bullet1">
<p class="Bullet1">portal.statusviewer.action.url.https=https://$HOST</p>
</li>
<li class="P-Bullet1">
<p class="Bullet1">portal.statusviewer.action.url.vnc=vnc://$HOST</p>
</li>
<li class="P-Bullet1">
<p class="Bullet1">portal.statusviewer.action.url.rdp=rdp://$HOST</p>
</li>
</ul>
<p>The $HOST variable will be substituted with the host name of the selected page in Status. If a user applies any changes to the default URL's the portal needs to be stopped and started before any changes will show up.</p>
<p class="CodeGroup">/usr/local/groundwork/ctlscript.sh stop gwservices</p>
<p class="CodeGroup">/usr/local/groundwork/ctlscript.sh start gwservices</p>
<h2><a name="MiniTOCBookMark56" id="MiniTOCBookMark56"></a>SSL</h2>
<h3><a name="MiniTOCBookMark57" id="MiniTOCBookMark57"></a>How to enable HTTPS (SSL) support for Apache</h3>
<p><i style="font-style: italic;">GroundWork Monitor</i> supports the use of <span style="font-style: italic;"><i>SSL</i></span> for encrypting web browser connections to <span style="font-style: italic;"><i>Apache</i></span>, although this feature is not enabled by default. If you would like to enable this feature, you must first create or import an <span style="font-style: italic;"><i>SSL Certificate for Apache</i></span> to use, and then enable the <span style="font-style: italic;"><i>SSL</i></span> support in the appropriate <span style="font-style: italic;"><i>Apache</i></span> configuration file(s). The binaries and libraries necessary to enable <span style="font-style: italic;"><i>SSL</i></span> support are included in the <span style="font-style: italic;"><i>GroundWork Monitor</i></span> distribution. The steps below outline how to enable <span style="font-style: italic;"><i>SSL</i></span> for the Apache Web Server.</p>
<p>For more information, please refer to the Apache site at: <a href="http://httpd.apache.org/docs/2.2/ssl/" target="_blank" style="font-size: 9pt;">http://httpd.apache.org/docs/2.2/ssl/</a></p>
<h4><a name="MiniTOCBookMark58" id="MiniTOCBookMark58"></a>Configuration Steps</h4>
<p>To enable <span style="font-style: italic;"><i>SSL</i></span> support in <span style="font-style: italic;"><i>GroundWork Monitor</i></span>:</p>
<ol style="font-size: 9pt;">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">If you have an existing <span style="font-style: italic;"><i>SSL</i></span> certificate and key file for your web server that you wish to reuse, you must edit the <span class="Code"><b>/usr/local/groundwork/apache2/conf/extra/httpd-ssl.conf</b></span> file to reference those files. The files must also have permissions that will allow them to be read by the <span style="font-style: italic;"><i>Apache</i></span> server on startup. A common situation in which you would use existing files would be if they were obtained from an external certificate authority.</p>
</li>
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">If you wish to create new self-signed certificate and key files, log in to the system as the <span class="Code">root</span> user and use the commands below from a terminal session. This will ensure appropriate default filenames and certificate settings, and correct permissions are used.</p>
</li>
</ol>
<p class="GroupCode2"><b style="font-weight: bold;"><span class="CodeInline">cd /usr/local/groundwork/apache2/conf</span></b></p>
<p class="GroupCode2"><b style="font-weight: bold;"><span class="CodeInline">openssl genrsa -out server.key 2048</span></b></p>
<p class="GroupCode2"><b style="font-weight: bold;"><span class="CodeInline">openssl req -new -x509 -key server.key -out server.crt -days 1095 -set_serial `date +%s`</span></b></p>
<p style="margin-left: 40px;"><font color="#FF0000"><b style="font-weight: bold;">Note:</b></font> The back-quotes surrounding the date-command invocation (`<span class="CodeInline"><font style="font-size: 9pt;" size="2">date +%s`</font></span>) are used to capture its output and substitute it into the command line.</p>
<p style="margin-left: 40px;">This command will create a certificate good for 3 years from the date of manufacture; (<span class="CodeInline"><font style="font-size: 9pt;" size="2">-days 1095</font></span>). You might wish to specify a longer period, such as 10 years; (<span class="CodeInline"><font style="font-size: 9pt;" size="2">-days 3653</font></span>), to move the expiration date even further into the future.</p>
<p style="margin-left: 40px;">The <span class="CodeInline"><font style="font-size: 9pt;" size="2">-set_serial</font></span> option specifies a hopefully-unique serial number for this certificate, in contrast to the fixed default of 0. Using a different value for this option each time you create a certificate helps to avoid problems with some browsers. The integer timestamp produced by the date command shown above in this context provides sufficient uniqueness for ordinary use.</p>
<p style="margin-left: 40px;">Answer the questions asked by the last command shown above. When prompted for the <span style="font-style: italic;"><i>Common Name</i></span>, you have two basic choices. If you will have some users who may access the system from outside your domain, answer with the fully qualified hostname of your web server. If all access will occur only from inside your domain, you may answer instead with the unqualified hostname of your web server.</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a <span style="font-style: italic;"><i>Distinguished Name</i></span> or a <span style="font-style: italic;"><i>DN</i></span>. There are quite a few fields but you can leave some blank. For some fields there will be a default value. If you enter '.', the field will be left blank.</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">-----</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">Country Name (2 letter code) [GB]:</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">State or Province Name (full name) [Berkshire]:</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">Locality Name (eg, city) [Newbury]:</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">Organization Name (eg, company) [My Company Ltd]:</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">Organizational Unit Name (eg, section) [ ]:</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">Common Name (eg, your name or your server's hostname) [ ]:</p>
<p class="NormalIndentBullet1" style="margin-left: 80px;">Email Address [ ]:</p>
<ol start="3" style="font-size: 9pt;" type="1">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Edit the file:</p>
</li>
</ol>
<p class="GroupCode2"><span class="CodeInline">/usr/local/groundwork/apache2/conf/httpd.conf</span></p>
<ol start="4" style="font-size: 9pt;" type="1">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Remove the <span class="CodeInline">#</span> symbol in the line below. <span style="color: #ff0000; font-weight: bold;"><font color="red"><b>Note:</b></font></span> Replace <span class="CodeInline">my-server</span> with the name of the actual server <span style="font-style: italic;"><i>Apache</i></span> is running on.:</p>
</li>
</ol>
<p class="GroupCode2">#LoadModule rewrite_module modules/mod_rewrite.so</p>
<p class="GroupCode2">#Include conf/extra/httpd-ssl.conf</p>
<p class="GroupCode2">#RewriteEngine On</p>
<p class="GroupCode2">#RewriteCond %{SERVER_PORT} !^443$</p>
<p class="GroupCode2">#RewriteRule ^/(.*)$ https://my-server/$1 [NE]</p>
<p style="margin-left: 40px;"><span style="font-style: italic;"><i>Apache ProxyPass</i></span> directives need to be set to the new connector on port 8443.</p>
<p class="GroupCode2">ProxyPass /foundation-webapp <span class="nobr">http://localhost:8443/foundation-webapp</span></p>
<p class="GroupCode2">ProxyPass /reportserver <span class="nobr">http://localhost:8443/reportserver</span></p>
<p class="GroupCode2">ProxyPass /birtviewer <span class="nobr">http://localhost:8443/birtviewer</span></p>
<p class="GroupCode2">ProxyPass /monarch/ <span class="nobr">http://localhost:8443/monarch/</span> timeout=5400</p>
<p class="GroupCode2">ProxyPass /monarch-export/ <span class="nobr">http://localhost:8443/monarch-export/</span></p>
<p class="GroupCode2">ProxyPass /josso/ <span class="nobr">http://localhost:8443/josso/</span></p>
<p class="GroupCode2">ProxyPass /nagios-app/ <span class="nobr">http://localhost:8443/nagios-app/</span></p>
<p class="GroupCode2">&#160;</p>
<p class="GroupCode2">ProxyPassMatch ^/nms-(.*)$ <span class="nobr">http://localhost:8443/nms-$1</span></p>
<p class="GroupCode2">ProxyPassMatch ^/(portal/auth/portal/groundwork-monitor/(?:admin|config|auto-disc).*)$ <span class="nobr">http://localhost:8443/$1</span> timeout=600</p>
<p class="GroupCode2">ProxyPassMatch ^/portal(.*)$ <span class="nobr">http://localhost:8443/portal$1</span></p>
<p class="GroupCode2">ProxyPassMatch ^/nagvis/(.*)$ <span class="nobr">http://localhost:8443/nagvis/$1</span></p>
<p class="GroupCode2">&#160;</p>
<p class="GroupCode2">ProxyPass /nagvis_share/ <span class="nobr">http://localhost:8443/nagvis_share/</span></p>
<ol start="5" style="font-size: 9pt;" type="1">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Save the changes you've just made to:</p>
</li>
</ol>
<p class="GroupCode2"><font color="#009B00"><span class="CodeInline">/usr/local/groundwork/apache2/conf/httpd.conf</span></font></p>
<ol start="6" style="font-size: 9pt;" type="1">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Edit</p>
</li>
</ol>
<p class="GroupCode2" style="font-size: 9pt;"><span class="CodeInline"><font style="font-size: 9pt;" color="#009B00" size="2">/usr/local/groundwork/c</font></span><span class="CodeInline"><font style="font-size: 9pt;" size="2">onfig/status-viewer.properties</font></span></p>
<p style="margin-left: 40px;">and change</p>
<p class="GroupCode2"><span class="CodeInline">secure.access.enabled=true</span></p>
<ol start="7" style="font-size: 9pt;" type="1">
<li class="P-Numbering" style="font-size: 9pt;">
<p class="Numbering">Edit</p>
</li>
</ol>
<p class="GroupCode2" style="font-size: 9pt;"><span class="CodeInline"><font style="font-size: 9pt;" color="#009B00" size="2">/usr/local/groundwork/c</font></span><span class="CodeInline"><font style="font-size: 9pt;" size="2">onfig/report-viewer.properties</font></span></p>
<p style="margin-left: 40px;">and change</p>
<p class="GroupCode2"><span class="CodeInline">secure.access.enabled=true</span></p>
<ol start="8" type="1">
<li class="P-Numbering">
<p class="Numbering">Edit</p>
</li>
</ol>
<p class="GroupCode2">/usr/local/groundwork/config/resources/josso-agent-config.xml</p>
<p style="margin-left: 40px;">and change the protocol for <span class="Code">gatewayLoginUrl</span> and <span class="Code">gatewayLogoutUrl</span> from <span class="Code">http://</span> to <span class="Code">https://</span></p>
<ol start="9" type="1">
<li class="P-Numbering">
<p class="Numbering">Edit the file:</p>
</li>
</ol>
<p class="GroupCode2"><span class="CodeInline">/usr/local/groundwork/foundation/container/webapps/jboss/jboss-web.deployer/server.xml</span></p>
<p style="margin-left: 40px;">Modify the Connector settings for port 8080 (line 27) by removing the <span class="Code">redirectPort="8443"</span> attribute. The connector setting should look as follows:</p>
<p class="GroupCode2" style="font-weight: bold;">&lt;Connector acceptCount="100" address="${jboss.bind.address}"</p>
<p class="GroupCode2" style="font-weight: bold;">&#160;&#160;&#160;&#160;&#160;connectionTimeout="20000" disableUploadTimeout="true"</p>
<p class="GroupCode2" style="font-weight: bold;">&#160;&#160;&#160;&#160;&#160;emptySessionPath="true" enableLookups="false" maxHttpHeaderSize="8192"</p>
<p class="GroupCode2" style="font-weight: bold;">&#160;&#160;&#160;&#160;&#160;maxThreads="250" port="8080" protocol="HTTP/1.1" /&gt;</p>
<p style="margin-left: 40px;">The HTTPS connector needs to be enabled to process HTTPS requests with a dedicated connector. Un-comment connector (line 37). Please add several attributes such as <span class="Code">proxyName</span> and <span class="Code">proxyPort</span> to the settings. Make sure to set the <span class="Code">proxyName</span> of the <span class="Code">8443</span> connector to be the CN of the certificate issued for this host. The HTTPS connector should look like the following after the edits:</p>
<p class="GroupCode2" style="font-weight: bold;">&lt;Connector acceptCount="100" address="${jboss.bind.address}"</p>
<p class="GroupCode2" style="font-weight: bold;">&#160;&#160;&#160;&#160;&#160;connectionTimeout="20000" disableUploadTimeout="true"</p>
<p class="GroupCode2" style="font-weight: bold;">&#160;&#160;&#160;&#160;&#160;emptySessionPath="true" enableLookups="false" maxHttpHeaderSize="8192"</p>
<p class="GroupCode2" style="font-weight: bold;">&#160;&#160;&#160;&#160;&#160;maxThreads="250" port="<span style="color: #ff0000;"><font color="red">8443</font></span>" protocol="HTTP/1.1"</p>
<p class="GroupCode2" style="color: #ff0000; font-weight: bold;">&#160;&#160;&#160;&#160;&#160;scheme="https" proxyName="cn.of.cert.for.this.host" proxyPort="443" /&gt;</p>
<ol start="10" type="1">
<li class="P-Numbering">
<p class="Numbering">Import the Certificate to the java keystore</p>
</li>
</ol>
<p style="margin-left: 40px;">Assuming you used the default certificate name, <span class="CodeInline">server.crt</span> in step 2, you should import this certificate with the following commands:</p>
<p class="GroupCode2">source /usr/local/groundwork/scripts/setenv.sh</p>
<p class="GroupCode2">keytool -import -file /usr/local/groundwork/apache2/conf/server.crt -alias myserver -keystore /usr/local/groundwork/java/jre/lib/security/cacerts</p>
<p style="margin-left: 40px;">Use your <span style="font-style: italic;"><i>GroundWork Monitor</i></span> host name as <span class="CodeInline">myserver</span>.</p>
<p style="margin-left: 40px;">The keytool will ask for the java keystore password. By default, this is: <span class="CodeInline">changeit</span></p>
<p style="margin-left: 40px;">It will also ask if the cert should be trusted. You should answer <span class="CodeInline">yes</span>.</p>
<ol start="11" type="1">
<li class="P-Numbering">
<p class="Numbering">Stop and Start gwservices</p>
</li>
</ol>
<p class="GroupCode2" style="font-size: 9pt;">/usr/local/groundwork/ctlscript.sh stop gwservices</p>
<p class="GroupCode2" style="font-size: 9pt;">/usr/local/groundwork/ctlscript.sh stop apache</p>
<p class="GroupCode2" style="font-size: 9pt;">/usr/local/groundwork/ctlscript.sh start gwservices</p>
<p class="GroupCode2" style="font-size: 9pt;">/usr/local/groundwork/ctlscript.sh start apache</p>
<p style="margin-left: 40px;">You may now bring up the site in a browser using <span class="Code">https</span>, for example: <span class="Code">https://myserver</span></p>
<div style="width: 100%; position: relative;" id="footer">
<p class="Footer" style="font-size: 7pt; line-height: Normal; margin-top: 6pt; margin-bottom: 4pt;">GroundWork, Inc. ©2011</p>
</div>
<script type="text/javascript" language="JavaScript1.2">
//<![CDATA[
        if( typeof( TextPopupInit ) != 'function' ) TextPopupInit = new Function();
        TextPopupInit('a2','POPUP383060338');
        TextPopupInit('a1','POPUP390567251');
        TextPopupInit('a3','POPUP378410614');
//]]>
</script><script type="text/javascript" language="javascript1.2">
//<![CDATA[
<!--
if (window.writeIntopicBar)
        writeIntopicBar(0);


highlightSearch();
//-->
//]]>
</script>
</body>
</html>
