<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0014)about:internet -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Adobe RoboHelp 8" />
<title>Data Retention</title>
<link rel="StyleSheet" href="../Bookshelf.css" type="text/css" />
<script type="text/javascript" language="JavaScript">
//<![CDATA[
function ehlp_showtip(current,e,text)
{
  if ((parseInt(navigator.appVersion) == 4) && (navigator.appName == 'Netscape'))
  {
    document.tooltip.document.write("<layer bgColor='yellow' style='border:1px solid black;font-size:12px;'>"+ text + "<\/layer>");
    document.tooltip.document.close();
    document.tooltip.left=e.pageX+5;
    document.tooltip.top=e.pageY+5;
    document.tooltip.visibility="show";
  }
}
function ehlp_hidetip()
{
  document.tooltip.visibility="hidden";
}
//]]>
</script>
<script type="text/javascript" language="JavaScript">
//<![CDATA[
function reDo() {
  if (innerWidth != origWidth || innerHeight != origHeight)
     location.reload();
}
if ((parseInt(navigator.appVersion) == 4) && (navigator.appName == "Netscape")) {
        origWidth = innerWidth;
        origHeight = innerHeight;
        onresize = reDo;
}
onerror = null; 
//]]>
</script>
<style type="text/css">
/*<![CDATA[*/
<!--
div.WebHelpPopupMenu { position:absolute;
left:0px;
top:0px;
z-index:4;
visibility:hidden; }
-->
/*]]>*/
</style>

<script type="text/javascript" language="javascript1.2" src="../whmsg.js">
</script>
<script type="text/javascript" language="javascript" src="../whver.js">
</script>
<script type="text/javascript" language="javascript1.2" src="../whproxy.js">
</script>
<script type="text/javascript" language="javascript1.2" src="../whutils.js">
</script>
<script type="text/javascript" language="javascript1.2" src="../whlang.js">
</script>
<script type="text/javascript" language="javascript1.2" src="../whtopic.js">
</script>
</head>
<body>
<script type="text/javascript" language="javascript1.2">
//<![CDATA[
<!--
if (window.gbWhTopic)
{
        var strUrl = document.location.href;
        var bc = 0;
        var n = strUrl.toLowerCase().indexOf("bc-");
        if(n != -1)
        {
                document.location.href = strUrl.substring(0, n);
                bc = strUrl.substring(n+3);
        }

        if (window.addTocInfo)
        {
        addTocInfo("SYSTEM MAINTENANCE\nData Retention");
addButton("show",BTN_TEXT,"Show Table of Contents","","","","",0,0,"","","");

        }
        if (window.writeBtnStyle)
                writeBtnStyle();

        if (window.writeIntopicBar)
                writeIntopicBar(1);

        
        

        if (window.setRelStartPage)
        {
        setRelStartPage("../Bookshelf.htm");

                autoSync(0);
                sendSyncInfo();
                sendAveInfoOut();
        }
}
else
        if (window.gbIE4)
                document.location.reload();

//-->
//]]>
</script><script type="text/javascript" language="JavaScript1.2" src="../ehlpdhtm.js">
</script><script type="text/javascript" language="javascript">
//<![CDATA[
document.write("<p  style=\"text-align:right;color:#0000ff;font-family:Arial;font-size:7pt;font-weight: normal;font-style: normal;text-decoration: none;\">");
AddMasterBreadcrumbs("../Bookshelf.htm", "color:#0000ff;font-family:Arial;font-size:7pt;font-weight: normal;font-style: normal;text-decoration: none;", "&gt;", "Home", "../Welcome_to_GroundWork_Monitor/index.htm");
document.write("<a style=\"color:#0000ff;font-family:Arial;font-size:7pt;font-weight: normal;font-style: normal;text-decoration: none;\" href=\"systemmaintenance_aboutsystemmaintenance.htm\">SYSTEM MAINTENANCE<\/a> &gt; Data Retention<\/p>");
//]]>
</script>
<p>&#160;</p>
<h1><a name="MiniTOCBookMark1" id="MiniTOCBookMark1"></a><img src="../Shared_Images/square.gif" alt="square.gif" style="border: none;" width="15" height="15" border="0" /> System Maintenance</h1>
<h3 align="right"><a href="systemmaintenance_aboutsystemmaintenance.htm" title="Topic Home" onmouseover="if ((parseInt(navigator.appVersion) == 4) &amp;&amp; (navigator.appName == 'Netscape')) ehlp_showtip(this,event,'Topic Home');" onmouseout="if ((parseInt(navigator.appVersion) == 4) &amp;&amp; (navigator.appName == 'Netscape')) ehlp_hidetip();"><img src="../Shared_Images/homeicon.gif" alt="homeicon.gif" style="border: none;" width="33" height="27" border="0" /></a> <img src="../Shared_Images/printicon.gif" onclick="window.print()" alt="Print Page" title="Print Page" style="border: none;" width="31" height="27" border="0" /> <a href="mailto:support@groundworkopensource.com?subject=Data Retention" title="Send Comments"><img src="../Shared_Images/commentsicon.gif" alt="commentsicon.gif" style="border: none;" width="33" height="27" border="0" /></a></h3>
<h2 class="Bullet1"><a name="MiniTOCBookMark2" id="MiniTOCBookMark2"></a>Data Retention</h2>
<p align="left">Table&#160;of&#160;Contents:&#160;<a class="dropspot" href="javascript:TextPopup(this)" id="MTHotSpot32205" name="MTHotSpot32205"><span class="MTText">Show</span><span class="MTText" style="display: none;">Hide</span></a></p>
<script type="text/javascript" language="JavaScript1.2">
//<![CDATA[
TextPopupInit('MTHotSpot32205', 'MTPOPUP32205');
//]]>
</script>
<div align="left" class="droptext" id="MTPOPUP32205" style="display: none;">
<ul style="text-align:left; list-style-type: circle;">
<li><a href="#MiniTOCBookMark3">Maintaining the Foundation Database (GWCollageDB)</a></li>
<li><a href="#MiniTOCBookMark5">Maintaining the Insight Reports Database (dashboard)</a></li>
<li><a href="#MiniTOCBookMark7">Log Rotation</a></li>
</ul>
</div>
<p class="Numbering" style="font-weight: normal;">This document covers how to selectively delete event messages from the <span style="font-style: italic;"><i>GWCollageDB</i></span> database, delete report entries from the dashboard database, and how to use logrotate to clean up log files.</p>
<h3><a name="MiniTOCBookMark3" id="MiniTOCBookMark3"></a>Maintaining the Foundation Database (GWCollageDB)</h3>
<h4><a name="MiniTOCBookMark4" id="MiniTOCBookMark4"></a>Selectively Delete Event Messages from the Foundation Database</h4>
<p>To selectively delete event messages from the <span style="font-style: italic;"><i>GWCollageDB</i></span> database that are older then a certain date, use the following procedure.</p>
<ol>
<li class="p-Numbering">
<p class="Numbering">Open a terminal session and login as: <span class="CodeInline">root</span></p>
</li>
<li class="p-Numbering">
<p class="Numbering">Make sure no one is logged into the system by stopping gwservices with the following command:</p>
</li>
</ol>
<p class="GroupCode2">/usr/local/groundwork/ctlscript.sh stop gwservices</p>
<ol start="3" type="1">
<li class="p-Numbering">
<p class="Numbering">Open the PostgreSQL console with the following command:</p>
</li>
</ol>
<p class="GroupCode2">psql -u root -p</p>
<ol start="4" type="1">
<li class="p-Numbering">
<p class="Numbering">Enter the following command:</p>
</li>
</ol>
<p class="GroupCode2">use \c gwcollagedb</p>
<ol start="5" type="1">
<li class="p-Numbering">
<p class="Numbering">Delete specific event messages by entering the following command with specified dates.</p>
</li>
</ol>
<p class="NormalIndentBullet1">This will delete event messages before January 1, 2009.</p>
<p class="GroupCode2">delete from LogMessage where ReportDate &lt; '2009-01-01 00:00:00';</p>
<ol start="6" type="1">
<li class="p-Numbering">
<p class="Numbering">Enter: <span class="CodeInline">exit</span></p>
</li>
<li class="p-Numbering">
<p class="Numbering">Restart gwservices with the following command:</p>
</li>
</ol>
<p class="GroupCode2">/usr/local/groundwork/ctlscript.sh start gwservices</p>
<h3><a name="MiniTOCBookMark5" id="MiniTOCBookMark5"></a>Maintaining the Insight Reports Database (dashboard)</h3>
<h4><a name="MiniTOCBookMark6" id="MiniTOCBookMark6"></a>Selectively Delete Report Entries from the Insight Reports Database</h4>
<p class="Numbering">To selectively delete report entries from the dashboard database that are older then a certain date, use the following procedure.</p>
<ol>
<li class="p-Numbering">
<p class="Numbering">Open a terminal session and login as: <span class="CodeInline">root</span></p>
</li>
<li class="p-Numbering">
<p class="Numbering">Make sure no one is logged into the system by:</p>
</li>
</ol>
<p class="NormalIndentBullet1">Stopping gwservices with the command:</p>
<p class="GroupCode2">/usr/local/groundwork/ctlscript.sh stop gwservices</p>
<p class="NormalIndentBullet1">Stopping httpd with the command:</p>
<p class="GroupCode2">/usr/local/groundwork/ctlscript.sh stop apache</p>
<ol start="3" type="1">
<li class="p-Numbering">
<p class="Numbering">Open the PostgreSQL console with the following command:</p>
</li>
</ol>
<p class="GroupCode2">psql -u root -p</p>
<ol start="4" type="1">
<li class="p-Numbering">
<p class="Numbering">Enter the following command:</p>
</li>
</ol>
<p class="GroupCode2">use \c dashboard</p>
<ol start="5" type="1">
<li class="p-Numbering">
<p class="Numbering">Delete specific report entries by entering the following commands with specified dates.</p>
</li>
</ol>
<p class="NormalIndentBullet1">This will delete daily alert entries before January 1, 2009.</p>
<p class="GroupCode2">delete from measurements where TIMESTAMP &lt; '2009-01-01';</p>
<p class="NormalIndentBullet1">This will delete daily host availability entries before January 1, &#160;2009.</p>
<p class="GroupCode2">delete from host_availability where DATESTAMP &lt; '2009-01-01'</p>
<p class="NormalIndentBullet1">This will delete daily service availability before January 1, 2009.</p>
<p class="GroupCode2">delete from service_availability where DATESTAMP &lt; '2009-01-01'</p>
<p class="NormalIndentBullet1">This will delete host group availability entries before January 1, 2009.</p>
<p class="GroupCode2">delete from hostgroup_host_availability where DATESTAMP &lt; '2009-01-01'</p>
<p class="NormalIndentBullet1">This will delete daily service availability entries before January 1, 2009.</p>
<p class="GroupCode2">delete from hostgroup_service_availability where DATESTAMP &lt; '2009-01-01'</p>
<ol start="6" type="1">
<li class="p-Numbering">
<p class="Numbering">Enter: <span class="CodeInline">exit</span></p>
</li>
<li class="p-Numbering">
<p class="Numbering">Restart gwservices with the following command:</p>
</li>
</ol>
<p class="GroupCode2">/usr/local/groundwork/ctlscript.sh start gwservices</p>
<ol start="8" type="1">
<li class="p-Numbering">
<p class="Numbering">Restart httpd with the following command:</p>
</li>
</ol>
<p class="GroupCode2">/usr/local/groundwork/ctlscript.sh start apache</p>
<h3><a name="MiniTOCBookMark7" id="MiniTOCBookMark7"></a>Log Rotation</h3>
<p>The packages that comprise <span style="font-style: italic;"><i>GroundWork Monitor</i></span> will generate log files in several places on the disk. This is by design, and is useful in many cases to find out what is happening with the data that the packages gather and store. Nagios, for example will use its log files for the default reports it generates.</p>
<p>The down side is that log file take up space, and so there are several settings needed for the Linux utility program known as logrotate to clean up these files periodically.</p>
<p><span style="font-style: italic;"><i>GroundWork</i></span> has adjusted these settings according to parameters that will work in most cases. Sometimes, however, it will be necessary to add or remove logs from rotation. For example, if a package is added, and it generates log files, these should be rotated to avoid filling the disk.</p>
<h4><a name="MiniTOCBookMark8" id="MiniTOCBookMark8"></a>Log Rotate Settings</h4>
<p>All the settings specific to <span style="font-style: italic;"><i>GroundWork</i></span> can be found in the file:</p>
<p class="CodeGroup">/etc/logrotate.d/groundwork</p>
<p>This file is created when <span style="font-style: italic;"><i>GroundWork Monitor</i></span> is installed, and is removed on un-install. This file may be edited to adjust the settings as necessary, however, when adjusting logrotate settings, be sure to test them with the following command using user <span class="CodeInline">root</span>:</p>
<p class="CodeGroup">logrotate -d /etc/logrotate.d/</p>
<h4><a name="MiniTOCBookMark9" id="MiniTOCBookMark9"></a>Log Files Rotated by Default</h4>
<p>The following log files are rotated by default at the interval of once a day, with old files saved for 8 days:</p>
<p class="CodeGroup">/usr/local/groundwork/apache2/logs/access_log<br />
/usr/local/groundwork/apache2/logs/error_log<br />
/usr/local/groundwork/services/foundation/log/main<br />
/usr/local/groundwork/foundation/container/logs/nagios2collage_hostgroupcheck.log</p>
<h4><a name="MiniTOCBookMark10" id="MiniTOCBookMark10"></a>Other Files</h4>
<p>The following files may or may not exist, depending on user settings. They will be rotated once a day, with old files saved for 8 days, if they do exist:</p>
<p class="CodeGroup">/usr/local/groundwork/nagios/eventhandlers/process_service_perf.log<br />
/usr/local/groundwork/var/log/snmp/snmptt.debug<br />
/usr/local/groundwork/var/log/snmp/snmptrapd.log<br />
/usr/local/groundwork/var/log/syslog-ng/ (all files)</p>
<p>The following files may be accidentally created, due to default settings in the Nagios tool. These settings are off by default in <span style="font-style: italic;"><i>GroundWork's</i></span> implementation of <span style="font-style: italic;"><i>Nagios</i></span>, but they would grow without bound if turned on, and that can fill the disk. Users should be aware that these files will be rotated by default every day, and that only one day's worth of old files will be kept.</p>
<p class="CodeGroup">/usr/local/groundwork/nagios/var/host-perfdata.dat<br />
/usr/local/groundwork/nagios/var/service-perfdata.dat</p>
<h4><a name="MiniTOCBookMark11" id="MiniTOCBookMark11"></a>Nagios Log Files</h4>
<p>Finally, the <span style="font-style: italic;"><i>Nagios</i></span> log files are archived by <span style="font-style: italic;"><i>Nagios</i></span>, but are never deleted. These files are useful for reporting purposes within the <span style="font-style: italic;"><i>Nagios</i></span> system (<span style="font-style: italic;"><i>Nagios</i></span> Reports). They can be large, however, especially if the default logging is changed in the Nagios tool to log more information, such as state stalking. Thus <span style="font-style: italic;"><i>GroundWork</i></span> settings will remove old log files after a month. The old <span style="font-style: italic;"><i>Nagios</i></span> log files are located in:</p>
<p class="CodeGroup">/usr/local/groundwork/nagios/var/archives</p>
<div style="width: 100%; position: relative;" id="footer">
<p class="Footer" style="font-size: 7pt; line-height: Normal; margin-top: 6pt; margin-bottom: 4pt;">GroundWork, Inc. ©2011</p>
</div>
<script type="text/javascript" language="JavaScript">
//<![CDATA[
 if ((parseInt(navigator.appVersion) == 4) && (navigator.appName == 'Netscape'))
  document.write("<div id='tooltip' class='WebHelpPopupMenu'><\/div>");
//]]>
</script><script type="text/javascript" language="javascript1.2">
//<![CDATA[
<!--
if (window.writeIntopicBar)
        writeIntopicBar(0);


highlightSearch();
//-->
//]]>
</script>
</body>
</html>
