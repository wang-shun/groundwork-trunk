<%
        import org.exoplatform.web.application.JavascriptManager;
        import org.exoplatform.portal.webui.util.Util;
        import org.exoplatform.portal.webui.workspace.UIPortalApplication;
        import org.exoplatform.portal.webui.page.UIPage;
        import org.exoplatform.portal.mop.user.UserNavigation;

        def rcontext = _ctx.getRequestContext();

        JavascriptManager jsmanager = rcontext.getJavascriptManager();
        jsmanager.require("SHARED/navigation", "nav").addScripts("nav.UIPortalNavigation.onLoad('" + uicomponent.id + "');");


        String addPageLabel = _ctx.appRes("UIAdminToolbarPortlet.action.AddPage");
        String editPageLabel = _ctx.appRes("UIAdminToolbarPortlet.action.EditPage");
        String editPortalLabel = _ctx.appRes("UIAdminToolbarPortlet.action.EditPortal");
        String editPageAndNaviLabel = _ctx.appRes("UIAdminToolbarPortlet.action.EditPageAndNavigation");
        String editSiteLayout = _ctx.appRes("UIAdminToolbarPortlet.action.EditSiteLayout");
        String editorLabel = _ctx.appRes("UIAdminToolbarPortlet.action.Editor");

        UserNavigation selectedNav = uicomponent.getSelectedNavigation();
        if (selectedNav != null) {
                editorLabel = _ctx.appRes("UIAdminToolbarPortlet.action." + selectedNav.getKey().getTypeName() + ".Editor");
                if (editorLabel != null && editorLabel.equalsIgnoreCase("Dashboard Editor")) {
                        editorLabel = "My GroundWork Editor";
                }
        }
        String accountSetting = "javascript:if(document.getElementById('UIMaskWorkspace')) ajaxGet(eXo.env.server.createPortalURL('UIPortal', 'AccountSettings', true));"
%>
<ul class="UIAdminToolbarPortlet UIHorizontalTabs" id="$uicomponent.id" >
        <li class="UITab NormalToolbarTab portlet-menu-item">
                <a class="EditorIcon TBIcon" href="#" title="$editorLabel">$editorLabel</a>
                <ul class="MenuItemContainer portlet-menu-cascade" style="display:none;">
                        
                                <li class="MenuItem portlet-menu-cascade-item">
                                        <a href="javascript:ajaxGet(eXo.env.server.createPortalURL('UIWorkingWorkspace', 'PageCreationWizard', true))" title="$addPageLabel" class="ItemIcon AddPageIcon">$addPageLabel</a>
                                </li>
                       

                        <% 

                                UIPortalApplication portalApp = Util.getUIPortalApplication();
                                UIPage uiPage = portalApp.findFirstComponentOfType(UIPage.class);//TODO: Find a better solution than this traversing
                                String editPageRequest = "javascript:ajaxGet(eXo.env.server.createPortalURL('" + uiPage.getId() + "', 'EditCurrentPage', true))";
                        %>
                                <li class="MenuItem">
                                        <a href="$editPageRequest" title="$editPageLabel" class="ItemIcon EditPageIcon">$editPageLabel</a>
                                </li>
                        

                       
                                <li class="MenuItem portlet-menu-cascade-item">
                                        <a href="javascript:ajaxGet(eXo.env.server.createPortalURL('UIWorkingWorkspace', 'EditInline', true))" title="$editSiteLayout" class="ItemIcon EditSiteIcon">$editSiteLayout</a>
                                </li>
                        
                </ul>
        </li>
</ul>
